# TG-Manager 图形界面设计规划

## 1. 总体设计

### 1.1 设计原则

- **简洁直观**：界面清晰，操作流程符合直觉，减少学习成本
- **功能完备**：完整覆盖所有核心功能，包括媒体下载、上传、转发、监听等
- **响应式布局**：适应不同屏幕大小和分辨率，支持窗口大小调整
- **主题支持**：支持浅色/深色主题，遵循系统设置，提供自定义选项
- **多语言支持**：初期支持中文和英文，后续可扩展其他语言
- **业务逻辑分离**：严格遵循业务逻辑与 UI 分离的架构设计，确保代码可维护性和扩展性

### 1.2 总体架构

- 采用 PyQt6/PySide6 框架开发
- 遵循 Model-View-Presenter (MVP) 架构模式
- 使用 Qt Material 主题增强视觉体验
- 所有耗时操作放入独立线程，避免界面卡顿
- 实现 asyncio 与 Qt 事件循环集成
- 基于事件驱动的业务逻辑与 UI 通信机制
- 连接已有的事件系统和 UI 回调接口
- 模块化设计，支持未来功能扩展

### 1.3 主界面布局

```
+-------------------------------------------------------------------------------+
|  菜单栏 [文件] [配置] [工具] [视图] [帮助]                                      |
+-------------------------------------------------------------------------------+
|  工具栏 [登录] [设置] [任务管理器] [日志查看器]                                  |
+-------------------------------------------------------------------------------+
|                                                                               |
|  +-------------------+     +-------------------------------------------+      |
|  |                   |     |                                           |      |
|  |  功能导航面板      |     |  主内容区（采用标签页组织各功能界面）        |      |
|  |                   |     |  +---------------------------------------+|      |
|  |  ● 媒体下载        |     |  | 标签: [下载] [上传] [转发] [监听] [设置] ||      |
|  |    - 普通下载      |     |  | +-----------------------------------+||      |
|  |    - 关键词下载    |     |  | |                                       ||      |
|  |  ● 媒体上传        |     |  | 功能操作区（当前激活的功能界面）        ||      |
|  |  ● 消息转发        |     |  |                                       ||      |
|  |  ● 消息监听        |     |  |                                       ||      |
|  |  ● 任务管理        |     |  |                                       ||      |
|  |  ● 系统设置        |     |  |                                       ||      |
|  |                   |     |  |                                       ||      |
|  +-------------------+     |  |                                       ||      |
|                            |  |                                       ||      |
|  +-------------------+     |  |                                       ||      |
|  |                   |     |  |                                       ||      |
|  |  当前任务概览      |     |  |                                       ||      |
|  |                   |     |  |                                       ||      |
|  |  - 活跃任务: 3     |     |  |                                       ||      |
|  |  - 已完成: 12      |     |  |                                       ||      |
|  |  - 等待中: 2       |     |  |                                       ||      |
|  |  - 失败: 0         |     |  |                                       ||      |
|  |                   |     |  |                                       ||      |
|  |  [查看所有任务]    |     |  |                                       ||      |
|  |                   |     |  |                                       ||      |
|  +-------------------+     +-------------------------------------------+      |
|                                                                               |
+-------------------------------------------------------------------------------+
|  状态栏 [功能提示]                      [客户端状态] [网络状态] [CPU/内存使用率]  |
+-------------------------------------------------------------------------------+
```

**主界面说明**：

- **顶部菜单栏和工具栏**：提供全局操作和快速访问常用功能。
- **左侧导航面板**：使用树形结构组织所有功能模块，允许用户快速在不同功能间切换。
- **功能标签栏**：使用标签页组织不同功能界面，允许同时打开多个功能并快速切换。
- **当前任务概览**：提供所有正在执行和等待中任务的摘要信息，让用户随时了解系统状态。
- **状态栏**：显示重要系统状态信息，如网络连接状态、当前活跃任务进度等。

主界面设计遵循以下原则：

1. **功能集中**：所有核心功能可通过导航面板一键访问
2. **状态透明**：系统和任务状态随时可见
3. **多任务支持**：允许同时进行多种操作，如下载的同时进行监听
4. **信息分层**：按重要性组织信息，避免界面混乱
5. **一致性**：所有功能模块采用一致的设计语言和交互模式

## 2. 功能模块界面

### 2.1 登录与身份验证界面

- **登录方式选择**：

  - API Key 登录（API ID 和 API Hash）
  - 会话字符串登录
  - Bot Token 登录

- **代理设置**：

  - 代理类型选择（无/SOCKS5/HTTP）
  - 代理地址和端口配置
  - 代理认证信息（可选）

- **身份验证流程**：
  - 手机号码输入框
  - 验证码输入框
  - 二步验证密码输入框（如有需要）
  - 记住会话选项

### 2.2 媒体上传界面

媒体上传功能允许用户将本地媒体文件上传到 Telegram 频道，界面设计如下：

```
+-------------------------------------------------------------------------------+
|  媒体上传                                                      [帮助] [设置]    |
+-------------------------------------------------------------------------------+
|                                                                               |
|  +-------------------+     +-------------------------------------------+      |
|  |                   |     |                                           |      |
|  |  目标频道配置      |     |  本地文件选择器                             |      |
|  |                   |     |  +---------------------------------------+|      |
|  |  ● 目标频道:       |     |  | 当前路径: E:\Media\Photos             ||      |
|  |    [添加] [编辑]   |     |  | [上一级] [刷新] [新建文件夹]           ||      |
|  |    - Channel One  |     |  | +-----------------------------------+||      |
|  |      状态: ✓ 可写   |     |  | |                                  |||      |
|  |    - Channel Two  |     |  | | [文件夹视图]                       |||      |
|  |      状态: ✓ 可写   |     |  | |                                  |||      |
|  |                   |     |  | | 📁 Event_2023                     |||      |
|  |  ● 上传顺序:       |     |  | | 📷 photo_001.jpg                 |||      |
|  |    [○] 按选择顺序   |     |  | | 📷 photo_002.jpg                 |||      |
|  |    [●] 按名称排序   |     |  | | 🎬 video_001.mp4                 |||      |
|  |    [○] 按大小排序   |     |  | | 📄 document.pdf                  |||      |
|  |                   |     |  | | 📄 title.txt                      |||      |
|  |  ● 智能选项:       |     |  | |                                  |||      |
|  |    [✓] 自动检测     |     |  | +-----------------------------------+||      |
|  |       媒体组       |     |  |                                       ||      |
|  |    [✓] 优先使用     |     |  | [全选] [取消选择] [添加到上传队列]      ||      |
|  |       非转发限制    |     |  |                                       ||      |
|  |       频道         |     |  | +---------------------------------------+|      |
|  |                   |     |                                           |      |
|  +-------------------+     +-------------------------------------------+      |
|                                                                               |
|  +-------------------+     +-------------------------------------------+      |
|  |                   |     |                                           |      |
|  |  上传选项          |     |  上传队列                                  |      |
|  |                   |     |  +---------------------------------------+|      |
|  |  ● 说明文字:       |     |  | 待上传: 5个文件，共127MB              ||      |
|  |    [✓] 使用文件夹   |     |  | +-----------------------------------+||      |
|  |       名称         |     |  | | 文件            | 大小   | 状态    |||      |
|  |    [✓] 读取title.txt|     |  | +-----------------------------------+||      |
|  |                   |     |  | | photo_001.jpg   | 2 MB   | 等待    |||      |
|  |  ● 媒体组设置:     |     |  | | photo_002.jpg   | 2 MB   | 等待    |||      |
|  |    [✓] 保持原始     |     |  | | video_001.mp4   | 120 MB | 上传中  |||      |
|  |       文件组合     |     |  | |   [━━━━━━━━━━━▶ 35%]              |||      |
|  |    [✓] 自动生成     |     |  | | document.pdf    | 3 MB   | 等待    |||      |
|  |       视频缩略图    |     |  | +-----------------------------------+||      |
|  |                   |     |  |                                       ||      |
|  |  ● 上传延迟:       |     |  | 当前进度: 上传 video_001.mp4         ||      |
|  |    [2] 秒          |     |  | 速度: 800KB/s  剩余时间: 1分40秒      ||      |
|  |                   |     |  | [暂停] [取消] [移动到顶部]             ||      |
|  |  [开始上传]        |     |  |                                       ||      |
|  |                   |     |  +---------------------------------------+|      |
|  +-------------------+     +-------------------------------------------+      |
|                                                                               |
+-------------------------------------------------------------------------------+
|  状态: 正在上传 1/5 | 已上传: 25个文件 (156 MB) | 历史记录 | 统计               |
+-------------------------------------------------------------------------------+
```

**媒体上传界面说明**：

- **目标频道配置区**：

  - 支持添加和管理多个目标频道
  - 显示每个频道的状态（可写/受限）
  - 上传顺序设置，支持多种排序方式
  - 智能选项，如自动检测媒体组、优先使用非转发限制频道

- **本地文件选择器**：

  - 支持浏览本地文件系统
  - 文件夹和文件以图标形式展示
  - 批量选择功能
  - 支持将选中的文件添加到上传队列

- **上传选项区**：

  - 说明文字设置，支持使用文件夹名称或读取 title.txt
  - 媒体组设置，可保持原始文件组合
  - 自动生成视频缩略图选项
  - 上传延迟设置，避免触发 API 限制
  - 开始上传按钮，触发上传任务

- **上传队列**：
  - 显示待上传文件列表
  - 实时显示上传进度和速度
  - 任务控制按钮（暂停、取消、优先级调整）
  - 详细的上传状态信息

**功能亮点**：

1. **智能媒体组处理**：

   - 自动识别同一文件夹中的相关文件，作为媒体组上传
   - 保持媒体组内文件的原始组织结构
   - 自动处理媒体说明文字

2. **高级通道选择**：

   - 自动检测频道权限状态
   - 优先使用无转发限制的频道
   - 显示频道状态指示器，帮助用户了解可能的限制

3. **文件说明智能处理**：

   - 支持从 title.txt 文件读取说明文字
   - 支持使用文件夹名称作为说明文字
   - 自动跳过 title.txt 文件本身的上传

4. **视频优化**：

   - 自动生成视频缩略图
   - 优化视频上传设置，确保最佳质量

5. **队列管理**：
   - 可视化上传队列
   - 支持调整上传优先级
   - 提供详细的进度和速度信息

### 2.3 消息转发界面

消息转发功能允许在不同频道间转发消息，包括文本和媒体内容，界面设计如下：

```
+-------------------------------------------------------------------------------+
|  消息转发                                                      [帮助] [设置]    |
+-------------------------------------------------------------------------------+
|                                                                               |
|  +-------------------+     +-------------------------------------------+      |
|  |                   |     |                                           |      |
|  |  频道配置          |     |  预览与监控                                |      |
|  |                   |     |  +---------------------------------------+|      |
|  |  ● 源频道:         |     |  | 准备转发 45 条消息                     ||      |
|  |    [添加] [编辑]   |     |  | [━━━━━━━━━━━━━━━━━▶ 45%]             ||      |
|  |    - Source One   |     |  | 已转发: 20/45  剩余时间: 3分钟         ||      |
|  |      ID范围:       |     |  +---------------------------------------+|      |
|  |      1000-2000    |     |  |                                       ||      |
|  |                   |     |  | 消息预览(当前/下一条):                  ||      |
|  |  ● 目标频道:       |     |  | +-----------------------------------+||      |
|  |    [添加] [编辑]   |     |  | | 📷 Source One                     |||      |
|  |    - Target One   |     |  | | 消息ID: 1025                      |||      |
|  |      权限: ✓ 可写   |     |  | |                                  |||      |
|  |    - Target Two   |     |  | | [图片预览]                         |||      |
|  |      权限: ✓ 可写   |     |  | |                                  |||      |
|  |                   |     |  | | 图片说明: 这是一张测试图片          |||      |
|  |  ● 频道配对:       |     |  | |                                  |||      |
|  |    [智能配对]      |     |  | +-----------------------------------+||      |
|  |    - Source One →  |     |  |                                       ||      |
|  |      Target One,   |     |  | [查看全部] [跳过当前] [暂停]           ||      |
|  |      Target Two    |     |  |                                       ||      |
|  |                   |     |  +---------------------------------------+|      |
|  +-------------------+     +-------------------------------------------+      |
|                                                                               |
|  +-------------------+     +-------------------------------------------+      |
|  |                   |     |                                           |      |
|  |  转发选项          |     |  转发历史与统计                            |      |
|  |                   |     |  +---------------------------------------+|      |
|  |  ● 内容过滤:       |     |  | 今日转发统计                          ||      |
|  |    [✓] 图片        |     |  | +-----------------------------------+||      |
|  |    [✓] 视频        |     |  | | 频道          | 消息数  | 完成率   |||      |
|  |    [✓] 文档        |     |  | +-----------------------------------+||      |
|  |    [✓] 文本消息    |     |  | | Source One → Target One | 115 | 100% |||      |
|  |    [ ] 贴纸        |     |  | | Source One → Target Two | 115 | 100% |||      |
|  |                   |     |  | +-----------------------------------+||      |
|  |  ● 高级设置:       |     |  |                                       ||      |
|  |    [✓] 隐藏作者     |     |  | 历史记录:                            ||      |
|  |    [ ] 删除说明文字 |     |  | [查看完整历史] [导出数据] [清除历史]   ||      |
|  |    [✓] 按原始顺序   |     |  |                                       ||      |
|  |                   |     |  | 错误统计:                             ||      |
|  |  ● 转发延迟:       |     |  | - 权限错误: 0                        ||      |
|  |    [2] 秒          |     |  | - API限制: 3 (已自动处理)             ||      |
|  |                   |     |  | - 其他错误: 0                         ||      |
|  |  [开始转发]        |     |  |                                       ||      |
|  |                   |     |  +---------------------------------------+|      |
|  +-------------------+     +-------------------------------------------+      |
|                                                                               |
+-------------------------------------------------------------------------------+
|  状态: 正在转发 | 进度: 20/45 (45%) | 历史记录 | 统计                         |
+-------------------------------------------------------------------------------+
```

**消息转发界面说明**：

- **频道配置区**：

  - 源频道管理，支持设置消息 ID 范围
  - 目标频道管理，显示权限状态
  - 频道配对设置，支持智能配对

- **转发选项区**：

  - 内容类型过滤，选择需要转发的媒体类型
  - 高级设置，如隐藏作者、删除说明文字等
  - 转发延迟设置，避免触发 API 限制
  - 开始转发按钮，触发转发任务

- **预览与监控区**：

  - 总体转发进度和速度显示
  - 当前/下一条消息预览
  - 含有媒体内容的预览图
  - 转发控制按钮（查看、跳过、暂停）

- **转发历史与统计区**：
  - 按频道配对显示转发统计
  - 历史记录查看和导出选项
  - 错误统计，分类显示不同类型的错误

**功能亮点**：

1. **智能频道配对**：

   - 自动配对源频道和目标频道
   - 支持一对多转发
   - 可视化显示配对关系

2. **权限自动检测**：

   - 检测目标频道的写入权限
   - 显示清晰的权限状态指示
   - 规避可能的权限问题

3. **内容预览**：

   - 实时预览正在转发的消息
   - 媒体内容缩略图显示
   - 帮助用户了解转发进度和内容

4. **错误智能处理**：

   - 自动处理 API 限制等常见错误
   - 详细分类显示错误统计
   - 提供错误恢复机制

5. **历史记录管理**：
   - 完整的转发历史记录
   - 支持导出数据和清除历史
   - 提供详细的统计信息

### 2.4 消息监听界面

消息监听功能允许实时监听频道的新消息，并可选择性地转发或下载，界面设计如下：

```
+-------------------------------------------------------------------------------+
|  消息监听                                                      [帮助] [设置]    |
+-------------------------------------------------------------------------------+
|                                                                               |
|  +-------------------+     +-------------------------------------------+      |
|  |                   |     |                                           |      |
|  |  监听配置          |     |  实时消息流                                |      |
|  |                   |     |  +---------------------------------------+|      |
|  |  ● 监听频道:       |     |  | 今日接收: 56条消息                     ||      |
|  |    [添加] [编辑]   |     |  | 当前活跃: 3个频道                      ||      |
|  |    - Listen One   |     |  | +-----------------------------------+||      |
|  |      状态: ● 活跃   |     |  | | 时间       | 频道    | 内容预览    |||      |
|  |    - Listen Two   |     |  | +-----------------------------------+||      |
|  |      状态: ● 活跃   |     |  | | 14:30:45  | Listen One | 📷 新图片.. |||      |
|  |                   |     |  | | 14:28:12  | Listen Two | 📄 新文档.. |||      |
|  |  ● 目标频道:       |     |  | | 14:25:36  | Listen One | 💬 文本消息 |||      |
|  |    [添加] [编辑]   |     |  | | 14:22:05  | Listen Two | 🎬 视频消息 |||      |
|  |    - Forward One  |     |  | | 14:20:17  | Listen One | 💬 文本消息 |||      |
|  |    - Forward Two  |     |  | +-----------------------------------+||      |
|  |                   |     |  |                                       ||      |
|  |  ● 监听设置:       |     |  | [查看详情] [手动转发] [下载媒体]        ||      |
|  |    [✓] 自动转发     |     |  |                                       ||      |
|  |    [✓] 自动下载     |     |  +---------------------------------------+|      |
|  |       媒体         |     |                                           |      |
|  |                   |     |  监听状态与统计                            |      |
|  |  [开始监听]        |     |  +---------------------------------------+|      |
|  |                   |     |  | 频道            | 接收  | 转发 | 下载  ||      |
|  +-------------------+     |  | Listen One     | 34    | 30   | 12   ||      |
|                            |  | Listen Two     | 22    | 20   | 8    ||      |
|  +-------------------+     |  |                                       ||      |
|  |                   |     |  | 按类型统计:                           ||      |
|  |  过滤器设置        |     |  | - 文本消息: 28                        ||      |
|  |                   |     |  | - 图片: 15                            ||      |
|  |  ● 关键词过滤:     |     |  | - 视频: 8                             ||      |
|  |    [✓] 启用        |     |  | - 文档: 5                             ||      |
|  |    关键词:         |     |  |                                       ||      |
|  |    - 重要          |     |  | [详细统计] [导出数据]                  ||      |
|  |    - 通知          |     |  |                                       ||      |
|  |                   |     |  +---------------------------------------+|      |
|  |  ● 媒体类型过滤:   |     |                                           |      |
|  |    [✓] 图片        |     |  当前消息详情                             |      |
|  |    [✓] 视频        |     |  +---------------------------------------+|      |
|  |    [✓] 文档        |     |  | 消息ID: 12345                         ||      |
|  |    [✓] 文本        |     |  | 频道: Listen One                      ||      |
|  |    [ ] 贴纸        |     |  | 类型: 图片                            ||      |
|  |                   |     |  | 时间: 2024-04-01 14:30:45             ||      |
|  |  ● 自动规则:       |     |  |                                       ||      |
|  |    [配置规则...]   |     |  | [图片预览]                            ||      |
|  |                   |     |  |                                       ||      |
|  +-------------------+     |  | 已转发到: Forward One, Forward Two     ||      |
|                            |  | 已下载到: downloads/Listen_One/12345.jpg ||    |
|                            |  |                                       ||      |
|                            |  +---------------------------------------+|      |
|                                                                               |
+-------------------------------------------------------------------------------+
|  状态: 监听中 | 活跃时间: 02:45:30 | 接收: 56 | 转发: 50 | 下载: 20           |
+-------------------------------------------------------------------------------+
```

**消息监听界面说明**：

- **监听配置区**：

  - 监听频道管理，显示每个频道的活跃状态
  - 目标频道设置，用于自动转发
  - 监听设置，如自动转发、自动下载等
  - 开始监听按钮，激活监听功能

- **过滤器设置区**：

  - 关键词过滤设置，只处理包含特定关键词的消息
  - 媒体类型过滤，选择需要处理的媒体类型
  - 自动规则配置，支持设置复杂的自动处理规则

- **实时消息流**：

  - 按时间顺序显示接收到的消息
  - 包含时间、频道和内容预览
  - 消息控制按钮（查看详情、手动转发、下载）

- **监听状态与统计**：

  - 按频道显示消息统计（接收、转发、下载）
  - 按媒体类型显示统计
  - 详细统计和数据导出选项

- **当前消息详情**：
  - 显示选中消息的详细信息
  - 媒体内容预览
  - 显示转发和下载状态

**功能亮点**：

1. **实时监控**：

   - 实时显示新接收的消息
   - 支持多频道同时监听
   - 显示清晰的活跃状态指示

2. **智能过滤**：

   - 支持关键词和媒体类型过滤
   - 可配置复杂的自动处理规则
   - 避免信息过载

3. **自动处理**：

   - 根据设置自动转发或下载媒体
   - 显示处理状态和结果
   - 支持手动干预操作

4. **详细统计**：

   - 多维度的消息统计
   - 按频道、类型分类显示
   - 支持导出数据进行深入分析

5. **灵活配置**：
   - 每个监听频道可有不同的配置
   - 支持动态调整监听设置
   - 提供暂停/恢复特定频道的选项

### 2.5 任务管理界面

任务管理界面提供对所有异步任务的集中监控和控制，界面设计如下：

```
+-------------------------------------------------------------------------------+
|  任务管理                                                      [帮助] [设置]    |
+-------------------------------------------------------------------------------+
|                                                                               |
|  +-------------------+     +-------------------------------------------+      |
|  |                   |     |                                           |      |
|  |  任务过滤器        |     |  任务队列                                  |      |
|  |                   |     |  +---------------------------------------+|      |
|  |  ● 任务类型:       |     |  | 共12个任务: 运行中(3), 等待(2), 完成(7) ||      |
|  |    [✓] 下载        |     |  | +-----------------------------------+||      |
|  |    [✓] 上传        |     |  | | ID | 类型  | 名称       | 状态    |||      |
|  |    [✓] 转发        |     |  | +-----------------------------------+||      |
|  |    [✓] 监听        |     |  | | 01 | 下载 | 从频道A下载  | 运行中  |||      |
|  |                   |     |  | |    | [━━━━━━━━━━━▶ 45%]            |||      |
|  |  ● 任务状态:       |     |  | | 02 | 上传 | 上传到频道B  | 运行中  |||      |
|  |    [✓] 运行中      |     |  | |    | [━━━━━━━━━━━━━━▶ 78%]        |||      |
|  |    [✓] 等待中      |     |  | | 03 | 转发 | A到B的转发   | 运行中  |||      |
|  |    [ ] 暂停        |     |  | |    | [━━━━━━━━━▶ 35%]              |||      |
|  |    [ ] 完成        |     |  | | 04 | 下载 | 关键词下载   | 等待中  |||      |
|  |    [ ] 失败        |     |  | | 05 | 上传 | 批量上传     | 等待中  |||      |
|  |                   |     |  | | 06 | 下载 | 历史下载     | 完成    |||      |
|  |  ● 优先级:         |     |  | | 07 | 上传 | 媒体上传     | 完成    |||      |
|  |    [✓] 高          |     |  | +-----------------------------------+||      |
|  |    [✓] 中          |     |  |                                       ||      |
|  |    [✓] 低          |     |  | [启动所有] [暂停所有] [取消选中]       ||      |
|  |                   |     |  |                                       ||      |
|  |  [刷新]            |     |  +---------------------------------------+|      |
|  |                   |     +-------------------------------------------+      |
|  +-------------------+     |                                           |      |
|                            |  任务详情                                  |      |
|  +-------------------+     |  +---------------------------------------+|      |
|  |                   |     |  | 任务ID: 01                            ||      |
|  |  系统资源          |     |  | 类型: 下载                            ||      |
|  |                   |     |  | 名称: 从频道A下载                     ||      |
|  |  ● CPU使用率:      |     |  | 状态: 运行中 (45%)                   ||      |
|  |    [━━━━━▶ 25%]    |     |  | 创建时间: 2024-04-01 13:45:30        ||      |
|  |                   |     |  | 运行时间: 00:15:45                    ||      |
|  |  ● 内存使用率:     |     |  |                                       ||      |
|  |    [━━━━━━━▶ 40%]  |     |  | 相关信息:                            ||      |
|  |                   |     |  | - 频道: Channel A                     ||      |
|  |  ● 网络流量:       |     |  | - 文件数: 25/56                      ||      |
|  |    ↓ 1.2 MB/s     |     |  | - 总大小: 120/256 MB                 ||      |
|  |    ↑ 0.3 MB/s     |     |  |                                       ||      |
|  |                   |     |  | 控制:                                 ||      |
|  |  ● 磁盘活动:       |     |  | [暂停] [继续] [取消] [优先级 ▼]       ||      |
|  |    [━━━━▶ 20%]     |     |  |                                       ||      |
|  |                   |     |  | 详细日志:                             ||      |
|  +-------------------+     |  | [查看] [导出]                         ||      |
|                            |  |                                       ||      |
|                            |  +---------------------------------------+|      |
|                                                                               |
+-------------------------------------------------------------------------------+
|  状态: 系统正常 | 任务: 12 | 活跃: 3 | CPU: 25% | 内存: 40% | 网络: 1.5MB/s   |
+-------------------------------------------------------------------------------+
```

**任务管理界面说明**：

- **任务过滤器区**：

  - 按任务类型过滤（下载、上传、转发、监听）
  - 按任务状态过滤（运行中、等待中、暂停、完成、失败）
  - 按优先级过滤（高、中、低）
  - 刷新按钮，更新任务列表

- **任务队列区**：

  - 显示所有任务的列表，包含 ID、类型、名称和状态
  - 对运行中的任务显示进度条
  - 任务批量控制按钮（启动所有、暂停所有、取消选中）

- **系统资源区**：

  - CPU 使用率监控
  - 内存使用率监控
  - 网络流量监控（上传和下载速度）
  - 磁盘活动监控

- **任务详情区**：
  - 显示选中任务的详细信息
  - 任务控制按钮（暂停、继续、取消、调整优先级）
  - 查看和导出任务日志的选项

**功能亮点**：

1. **统一任务管理**：

   - 集中管理所有类型的任务
   - 提供一致的控制接口
   - 支持批量操作和优先级调整

2. **详细状态监控**：

   - 实时显示任务进度和状态
   - 提供任务的详细信息和历史记录
   - 支持任务日志导出和分析

3. **资源使用监控**：

   - 监控系统资源使用情况
   - 帮助用户理解性能瓶颈
   - 优化并发任务数量

4. **灵活过滤机制**：

   - 多维度任务过滤
   - 快速定位特定任务
   - 支持按状态、类型和优先级筛选

5. **智能调度**：
   - 基于优先级的任务调度
   - 资源受限时自动调整并发任务
   - 确保关键任务优先执行

### 2.6 本地文件上传界面

- **目标频道配置**：

  - 目标频道选择列表
  - 频道权限状态指示
  - 智能排序开关
  - 分类标签功能

- **本地文件选择器**：

  - 文件目录树
  - 文件/文件夹拖放区域
  - 媒体预览窗格
  - 文件选择按钮
  - 媒体组自动识别功能

- **上传选项设置**：

  - 说明文字模板编辑器
  - 媒体组选项（是否分组上传）
  - 视频缩略图生成选项
    - 自动生成选项
    - 手动选择缩略图
    - 缩略图预览和编辑
  - 上传延迟设置
  - title.txt 说明文字自动识别选项

- **上传队列管理**：
  - 队列中的文件列表
  - 上传进度和状态
  - 取消/重试按钮
  - 文件排序功能
  - 智能频道选择状态

### 2.7 实时消息监听界面

- **监听配置区**：

  - 监听频道添加/删除按钮
  - 转发目标频道配置
  - 每个频道对单独配置选项
  - 监听截止日期设置
  - 转发延迟设置

- **消息过滤设置**：

  - 媒体类型过滤器（多选框）
  - 文本替换规则编辑器
    - 按频道设置不同规则
    - 规则测试功能
    - 批量导入导出规则
  - 说明文字处理选项
  - 媒体组处理设置
    - 媒体组整体处理模式开关
    - 媒体组排序选项

- **监听控制台**：

  - 开始/停止监听按钮
  - 监听状态和持续时间
  - 活跃监听频道列表
  - 按频道暂停/恢复选项
  - 频道指示灯（活跃/暂停/错误）

- **消息预览区**：

  - 最近收到的消息预览
    - 消息类型指示图标
    - 媒体组标记
    - 源频道标签
  - 转发状态指示
  - 消息详情查看按钮
  - 手动转发/跳过控制
  - 实时消息计数器

- **转发状态面板**：
  - 按频道分组的转发统计
  - 转发成功/失败/等待计数
  - 错误信息查看选项
  - 重新转发失败消息按钮

### 2.8 系统设置界面

系统设置界面提供对应用程序各方面的配置，界面设计采用选项卡组织不同类别的设置：

```
+-------------------------------------------------------------------------------+
|  系统设置                                                      [帮助] [重置]    |
+-------------------------------------------------------------------------------+
|                                                                               |
|  [常规] [网络] [账户] [下载] [上传] [转发] [监听] [存储] [高级]                  |
|  +-----------------------------------------------------------------------------+
|  |                                                                             |
|  |  常规设置                                                                    |
|  |                                                                             |
|  |  ● 界面设置:                                                                 |
|  |    界面语言:      [中文 ▼]                                                   |
|  |    界面主题:      [○] 浅色  [●] 深色  [○] 跟随系统                           |
|  |    字体大小:      [小 ○] [中 ●] [大 ○]                                      |
|  |                                                                             |
|  |  ● 启动设置:                                                                 |
|  |    [✓] 启动时自动连接Telegram                                                |
|  |    [✓] 启动时最小化到系统托盘                                                |
|  |    [✓] 系统启动时自动运行                                                    |
|  |    [○] 每次启动时检查更新  [●] 仅检查主要版本更新  [○] 不检查更新             |
|  |                                                                             |
|  |  ● 通知设置:                                                                 |
|  |    [✓] 任务完成通知                                                          |
|  |    [✓] 错误通知                                                             |
|  |    [✓] 新消息通知                                                           |
|  |    [✓] 声音提示                                                             |
|  |    通知方式:      [●] 系统通知  [○] 应用内通知  [○] 两者都使用                |
|  |                                                                             |
|  |  ● 数据与隐私:                                                               |
|  |    [✓] 保存操作历史 ([30 ▼] 天)                                             |
|  |    [✓] 匿名使用统计 (帮助我们改进应用)                                        |
|  |    [安全设置...]  [导出所有数据...]  [清除所有数据...]                        |
|  |                                                                             |
|  |                                                [应用] [取消] [恢复默认值]     |
|  +-----------------------------------------------------------------------------+
|                                                                               |
+-------------------------------------------------------------------------------+
|  状态: 设置未保存                                                              |
+-------------------------------------------------------------------------------+
```

**常规设置界面说明**：

- **界面设置**：

  - 语言选择
  - 主题设置（浅色/深色/跟随系统）
  - 字体大小调整

- **启动设置**：

  - 自动连接选项
  - 启动行为设置
  - 更新检查选项

- **通知设置**：

  - 不同类型事件的通知开关
  - 通知方式选择
  - 声音提示选项

- **数据与隐私**：
  - 历史记录保存设置
  - 使用统计选项
  - 安全设置和数据管理选项

**网络设置选项卡内容**：

```
+-----------------------------------------------------------------------------+
|                                                                             |
|  网络设置                                                                    |
|                                                                             |
|  ● 代理设置:                                                                 |
|    [✓] 使用代理                                                              |
|    代理类型:      [SOCKS5 ▼]                                                |
|    代理地址:      [127.0.0.1                ]  端口: [1080]                  |
|    [✓] 需要认证                                                             |
|    用户名:        [user            ]                                         |
|    密码:          [********        ]                                         |
|    [测试连接]                                                                |
|                                                                             |
|  ● 连接设置:                                                                 |
|    重连间隔:      [5 ▼] 秒                                                  |
|    最大重试次数:  [3 ▼]                                                     |
|    连接超时:      [30 ▼] 秒                                                 |
|    [✓] 断线自动重连                                                          |
|                                                                             |
|  ● API设置:                                                                  |
|    默认请求延迟:  [2 ▼] 秒                                                  |
|    [✓] 智能调整延迟（根据API限制动态调整）                                    |
|    最大API并发数: [5 ▼]                                                     |
|    [✓] 在速率限制时自动暂停任务                                              |
|                                                                             |
|  ● 带宽控制:                                                                 |
|    [✓] 限制下载速度: [2 ▼] MB/s                                             |
|    [✓] 限制上传速度: [1 ▼] MB/s                                             |
|    [○] 全天限制  [●] 自定义时段限制  从 [23:00] 到 [07:00]                   |
|                                                                             |
|                                                [应用] [取消] [恢复默认值]     |
+-----------------------------------------------------------------------------+
```

**账户设置选项卡内容**：

```
+-----------------------------------------------------------------------------+
|                                                                             |
|  账户设置                                                                    |
|                                                                             |
|  ● 当前账户:                                                                 |
|    用户名:        @current_user                                              |
|    API ID:        12345678                                                  |
|    API Hash:      ************abcdef1234567890                              |
|    电话号码:      +86 138****1234                                            |
|    状态:          已连接                                                     |
|    [登出] [刷新] [查看会话信息]                                              |
|                                                                             |
|  ● 会话管理:                                                                 |
|    会话文件位置:  [C:\Users\Username\AppData\TG-Manager\sessions]            |
|    [✓] 加密会话文件                                                          |
|    密码强度:      [强]                                                       |
|    [修改密码] [备份会话] [恢复会话]                                          |
|                                                                             |
|  ● 多账户:                                                                   |
|    [✓] 启用多账户支持                                                        |
|    [添加新账户] [切换账户 ▼]                                                 |
|                                                                             |
|  ● 机器人集成:                                                               |
|    [✓] 启用机器人API                                                         |
|    机器人Token:   [****************]                                         |
|    [✓] 允许机器人接收通知                                                     |
|    [✓] 允许机器人控制应用                                                     |
|                                                                             |
|                                                [应用] [取消] [恢复默认值]     |
+-----------------------------------------------------------------------------+
```

**其他功能选项卡说明**：

1. **下载设置**：

   - 默认下载路径配置
   - 媒体类型过滤默认值
   - 并行下载参数
   - 文件组织规则
   - 下载历史管理

2. **上传设置**：

   - 默认目标频道
   - 媒体组处理选项
   - 上传队列大小
   - 缩略图生成选项
   - 说明文字模板

3. **转发设置**：

   - 默认转发选项
   - 转发延迟参数
   - 转发历史管理
   - 错误处理策略
   - 内容处理规则

4. **监听设置**：

   - 默认监听频道
   - 监听过滤器规则
   - 自动处理设置
   - 通知规则
   - 监听日志管理

5. **存储设置**：
   - 缓存管理
   - 临时文件处理
   - 存储空间监控
   - 自动清理规则
   - 备份与恢复选项

**全局设置功能亮点**：

1. **分类组织**：

   - 通过选项卡清晰分类不同设置
   - 相关设置集中展示，方便查找
   - 统一的设置界面风格

2. **多层次控制**：

   - 从基础到高级的设置选项
   - 普通用户可只关注基本设置
   - 高级用户可深入调整详细参数

3. **实时验证**：

   - 设置修改时实时验证有效性
   - 无效设置会显示警告
   - 测试连接等功能确保设置正确

4. **智能默认值**：

   - 预设合理的默认值
   - 根据系统配置调整建议值
   - "恢复默认值"选项便于重置

5. **配置导入导出**：
   - 支持配置的备份和恢复
   - 跨设备同步设置
   - 配置文件版本控制

## 3. 辅助功能界面

除了核心功能界面外，TG-Manager 还提供多个辅助功能界面，增强用户体验和工作效率。这些界面包括：

### 3.1 日志查看器

日志查看器提供对系统日志的集中查看和分析功能：

```
+-------------------------------------------------------------------------------+
|  日志查看器                                                    [帮助] [导出]    |
+-------------------------------------------------------------------------------+
|                                                                               |
|  [全部] [系统] [下载] [上传] [转发] [监听] [错误] [警告]                       |
|  +-----------------------------------------------------------------------------+
|  | 搜索: [                                      ] [✓] 正则表达式  [搜索]        |
|  | 日志级别: [✓] 调试 [✓] 信息 [✓] 警告 [✓] 错误 [✓] 严重错误                  |
|  | 时间范围: [今天 ▼]  从 [2024-04-01 00:00] 到 [2024-04-01 23:59]           |
|  +-----------------------------------------------------------------------------+
|  |                                                                             |
|  | 时间戳        | 级别  | 模块   | 消息                                        |
|  |-----------------------------------------------------------------------------|
|  | 14:30:45.123 | 信息  | 下载   | 开始下载任务: 从频道A下载媒体                 |
|  | 14:30:46.234 | 调试  | 下载   | 连接到频道A (ID: 123456789)                 |
|  | 14:30:48.345 | 信息  | 下载   | 找到56个媒体文件可下载                        |
|  | 14:30:50.456 | 警告  | 下载   | 文件大小超过限制: video_123.mp4 (150MB)      |
|  | 14:30:52.567 | 错误  | API    | FloodWait错误: 需要等待15秒                  |
|  | 14:31:08.678 | 信息  | 下载   | 恢复下载任务                                 |
|  | 14:31:10.789 | 调试  | 下载   | 下载进度: 10%                                |
|  |                                                                             |
|  |                                                                             |
|  +-----------------------------------------------------------------------------+
|  | 日志详情:                                                                   |
|  | 时间: 2024-04-01 14:30:52.567                                              |
|  | 级别: 错误                                                                  |
|  | 模块: API                                                                   |
|  | 消息: FloodWait错误: 需要等待15秒                                           |
|  | 详细信息: 触发错误的请求类型: GetHistory, 频道ID: 123456789                  |
|  | 处理方式: 自动等待并重试                                                     |
|  | 堆栈跟踪: [显示/隐藏]                                                       |
|  +-----------------------------------------------------------------------------+
|                                                                               |
+-------------------------------------------------------------------------------+
|  总计: 1,245条日志 | 筛选后: 56条 | 错误: 12 | 警告: 24 | 自动清理: 30天后       |
+-------------------------------------------------------------------------------+
```

**日志查看器功能**：

- 多标签分类不同模块日志
- 强大的搜索和过滤功能
- 日志级别和时间范围过滤
- 详细的日志条目信息查看
- 导出和分析功能

### 3.2 频道管理器

频道管理器提供集中管理所有 Telegram 频道的界面：

```
+-------------------------------------------------------------------------------+
|  频道管理器                                                    [帮助] [刷新]    |
+-------------------------------------------------------------------------------+
|                                                                               |
|  +-------------------+     +-------------------------------------------+      |
|  |                   |     |                                           |      |
|  |  频道列表          |     |  频道详情                                  |      |
|  |                   |     |  +---------------------------------------+|      |
|  |  ● 我的频道:       |     |  | 名称: Channel One                     ||      |
|  |    [添加] [刷新]   |     |  | ID: -1001234567890                   ||      |
|  |    - Channel One  |     |  | 类型: 公开频道                         ||      |
|  |    - Channel Two  |     |  | 用户名: @channel_one                  ||      |
|  |                   |     |  | 订阅人数: 约5,600                      ||      |
|  |  ● 收藏频道:       |     |  |                                       ||      |
|  |    - News Channel |     |  | 描述:                                 ||      |
|  |    - Tech Updates |     |  | 这是一个测试频道，用于TG-Manager的功能展示 ||      |
|  |                   |     |  |                                       ||      |
|  |  ● 分组:          |     |  | 权限状态:                             ||      |
|  |    + 下载源        |     |  | - 读取: ✓ 允许                         ||      |
|  |    + 上传目标      |     |  | - 写入: ✓ 允许                         ||      |
|  |    + 转发目标      |     |  | - 媒体: ✓ 允许                         ||      |
|  |                   |     |  | - 转发限制: ✓ 无限制                   ||      |
|  |  [创建分组]        |     |  |                                       ||      |
|  |                   |     |  | [测试连接] [检查权限] [打开在Telegram中] ||      |
|  +-------------------+     |  |                                       ||      |
|                            |  +---------------------------------------+|      |
|  +-------------------+     |                                           |      |
|  |                   |     |  使用情况                                  |      |
|  |  搜索与筛选        |     |  +---------------------------------------+|      |
|  |                   |     |  | 作为下载源使用: 2次                     ||      |
|  |  频道搜索:         |     |  | 作为上传目标使用: 5次                   ||      |
|  |  [                ]     |  | 作为转发源使用: 3次                     ||      |
|  |                   |     |  | 作为转发目标使用: 8次                   ||      |
|  |  类型筛选:         |     |  | 作为监听源使用: 1次                    ||      |
|  |    [✓] 公开频道     |     |  |                                       ||      |
|  |    [✓] 私有频道     |     |  | 最近活动:                             ||      |
|  |    [✓] 群组        |     |  | - 上传文件: 2024-04-01 13:45          ||      |
|  |                   |     |  | - 下载媒体: 2024-03-31 19:23          ||      |
|  |  角色筛选:         |     |  | - 转发消息: 2024-03-30 08:15          ||      |
|  |    [✓] 下载源      |     |  |                                       ||      |
|  |    [✓] 上传目标    |     |  | [查看完整历史记录]                     ||      |
|  |    [✓] 转发源      |     |  |                                       ||      |
|  |    [✓] 转发目标    |     |  +---------------------------------------+|      |
|  |    [✓] 监听源      |     |                                           |      |
|  |                   |     |                                           |      |
|  +-------------------+     +-------------------------------------------+      |
|                                                                               |
+-------------------------------------------------------------------------------+
|  状态: 共36个频道 | 分组: 5个 | 上次刷新: 2024-04-01 14:30                    |
+-------------------------------------------------------------------------------+
```

**频道管理器功能**：

- 集中管理所有频道
- 频道分组和标签功能
- 详细的频道信息显示
- 权限状态检查
- 使用历史和统计

### 3.3 其他辅助功能

其他辅助功能包括：

1. **媒体预览器**：

   - 预览下载和准备上传的媒体文件
   - 支持图片、视频、文档等多种媒体类型
   - 简单的编辑功能，如裁剪、旋转等
   - 生成缩略图功能

2. **媒体组管理器**：

   - 创建和编辑媒体组
   - 通过拖放重排媒体项
   - 批量编辑说明文字
   - 预览媒体组效果

3. **统计分析器**：
   - 详细的使用统计图表
   - 下载、上传、转发数据分析
   - 资源使用趋势
   - 导出报告功能

## 4. 实现路线图

TG-Manager 的图形界面将按以下阶段逐步实现：

1. **基础框架阶段**（4 周）：

   - PyQt6/PySide6 环境搭建
   - UI 框架与业务逻辑分离接口实现
   - 事件系统与 UI 回调整合
   - 主界面布局和导航功能

2. **核心功能界面阶段**（8 周）：

   - 下载界面实现
   - 上传界面实现
   - 转发界面实现
   - 监听界面实现
   - 任务管理界面实现
   - 设置界面实现

3. **辅助功能阶段**（4 周）：

   - 日志查看器
   - 媒体预览器
   - 频道管理器
   - 统计分析功能

4. **优化与完善阶段**（4 周）：

   - 性能优化
   - 用户体验改进
   - 多语言支持
   - 主题完善
   - 文档和帮助系统

5. **打包与发布阶段**（2 周）：
   - Windows/Linux 安装包制作
   - 自动更新机制
   - 用户反馈系统

总计约 22 周的开发周期，将根据实际进展适当调整。

## 5. 总结

TG-Manager 的图形界面设计以用户体验为中心，提供全面且直观的功能访问，同时保持高度的可定制性和灵活性。关键设计要点包括：

1. **完整功能覆盖**：

   - 覆盖所有核心功能：下载、上传、转发、监听
   - 提供丰富的辅助功能和工具
   - 保持与命令行版本的功能一致性

2. **业务逻辑与 UI 分离**：

   - 基于已实现的事件系统和 UI 回调机制
   - 确保核心功能与界面展示的清晰分离
   - 支持未来功能扩展和界面升级

3. **直观的用户界面**：

   - 清晰的功能导航和组织
   - 一致的界面风格和交互模式
   - 详细的状态反馈和进度指示

4. **高度可定制**：

   - 丰富的设置选项
   - 界面布局的灵活调整
   - 支持主题和语言切换

5. **性能与稳定性**：
   - 任务管理系统确保高效处理
   - 资源监控和优化
   - 错误恢复和容错机制

通过实现这一图形界面，TG-Manager 将从命令行工具转变为功能完备的桌面应用，为用户提供更加直观和高效的 Telegram 消息管理体验。
