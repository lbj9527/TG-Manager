# TG-Manager 图形界面实现文档

## 1. 总体设计

### 1.1 设计原则

- **简洁直观**：界面清晰，操作流程符合直觉，减少学习成本
- **功能完备**：完整覆盖所有核心功能，包括媒体下载、上传、转发、监听等
- **响应式布局**：适应不同屏幕大小和分辨率，支持窗口大小调整
- **主题支持**：支持浅色/深色主题，遵循系统设置，提供自定义选项
- **业务逻辑分离**：严格遵循业务逻辑与 UI 分离的架构设计，确保代码可维护性和扩展性

### 1.2 总体架构

- 采用 PySide6(Qt6)框架开发
- 遵循 Model-View-Presenter (MVP)架构模式
- 使用 Qt 主题增强视觉体验，支持深色和浅色模式
- 所有耗时操作放入独立线程，避免界面卡顿
- 实现 asyncio 与 Qt 事件循环集成
- 基于事件驱动的业务逻辑与 UI 通信机制
- 模块化设计，支持未来功能扩展

### 1.3 主界面布局

- **顶部**：菜单栏和工具栏，提供全局操作
- **左侧**：导航树和任务概览区域，通过分割器灵活调整大小
- **中央**：主内容区，通过标签页组织各功能模块
- **底部**：状态栏，显示系统状态、网络连接和资源使用情况

主界面实现了以下功能：

1. 导航树用于功能模块切换
2. 任务概览提供当前任务的状态和进度
3. 可折叠的侧边栏，灵活调整工作区域
4. 系统托盘支持，可最小化到托盘运行
5. 窗口状态保存与恢复
6. 资源使用监控

## 2. 功能模块界面

### 2.1 下载界面 (DownloadView)

下载界面提供从 Telegram 频道下载媒体文件的功能，主要组件包括：

- **频道配置区**：
  - 频道链接/ID 输入
  - 消息 ID 范围设置
  - 关键词过滤支持
  - 频道管理（添加/删除）
- **媒体类型选择**：
  - 照片、视频、文档、音频等类型过滤
  - 文件大小过滤
- **下载选项**：
  - 下载路径设置
  - 并行下载数配置
  - 文件命名规则
  - 下载延迟设置
- **下载任务管理**：
  - 下载进度显示
  - 任务状态监控
  - 任务控制（暂停/继续/取消）

下载界面支持两种模式：普通下载和关键词下载，通过标签页组织不同的配置选项。

### 2.2 上传界面 (UploadView)

上传界面提供将本地媒体文件上传到 Telegram 频道的功能，主要组件包括：

- **目标频道配置**：
  - 频道链接/ID 输入
  - 频道管理（添加/删除）
- **本地文件浏览器**：
  - 文件系统树视图
  - 文件选择和预览
  - 批量选择支持
- **上传选项**：
  - 说明文字设置（文件夹名称/title.txt/自定义模板）
  - 自动生成视频缩略图选项
  - 上传延迟设置
- **上传队列管理**：
  - 队列显示和控制
  - 上传进度和速度显示
  - 文件状态跟踪

上传界面通过分割布局同时显示本地文件浏览和上传队列，方便用户操作。

### 2.3 转发界面 (ForwardView)

转发界面提供在不同 Telegram 频道间转发消息的功能，主要组件包括：

- **频道配对配置**：
  - 源频道和目标频道设置
  - 频道对管理（添加/删除）
- **媒体类型过滤**：
  - 照片、视频、文档、音频、动画等选择
- **转发选项**：
  - 移除说明文字选项
  - 隐藏转发来源选项
  - 转发延迟设置
- **转发状态显示**：
  - 转发进度监控
  - 频道对状态显示
  - 失败任务重试

转发界面支持一对多转发，可以将一个源频道的消息同时转发到多个目标频道。

### 2.4 监听界面 (ListenView)

监听界面提供实时监听 Telegram 频道消息并自动处理的功能，主要组件包括：

- **监听配置**：
  - 源频道和目标频道设置
  - 频道对管理（添加/删除）
  - 文本替换规则
  - 移除媒体说明选项
- **媒体类型过滤**：
  - 照片、视频、文档等选择
- **监听选项**：
  - 自动转发设置
  - 自动下载设置
  - 延迟参数配置
- **消息显示区**：
  - 实时显示监听到的消息
  - 消息类型和内容预览
  - 消息统计信息

监听界面能够长时间运行，监控频道的新消息并根据设置自动处理。

### 2.5 设置界面 (SettingsView)

设置界面提供应用程序全局配置管理，通过标签页组织不同类别的设置：

- **API 设置**：
  - Telegram API ID 和 Hash 配置
  - 手机号码设置
  - 会话管理选项
- **代理设置**：
  - 代理启用/禁用开关
  - 代理类型选择(SOCKS5)
  - 代理服务器配置
  - 认证信息设置
- **界面设置**：
  - 主题选择(浅色/深色)
  - 启动选项
  - 系统托盘行为
  - 通知设置

设置界面实现了配置的自动保存和加载，支持重置为默认设置。

### 2.6 任务管理器 (TaskView)

任务管理器提供对所有后台任务的集中管理，主要功能包括：

- 所有任务的列表显示
- 任务详细信息查看
- 任务控制（启动/暂停/取消）
- 任务优先级调整
- 任务历史记录和统计
- 系统资源使用监控

任务管理器作为独立模块，可以监控并控制来自所有功能模块的后台任务。

### 2.7 日志查看器 (LogViewerView)

日志查看器提供对应用日志的集中查看和管理，主要功能包括：

- 日志过滤（按级别、模块、时间）
- 日志搜索（支持关键词和正则表达式）
- 日志详情查看
- 日志导出
- 日志清理

日志查看器帮助用户诊断问题和了解应用程序运行状态。

## 3. 辅助组件

### 3.1 导航树 (NavigationTree)

导航树提供功能模块的层级导航，主要特点：

- 树形结构组织功能模块
- 图标和文本显示
- 选择事件处理
- 折叠/展开支持
- 模块分组显示

### 3.2 任务概览 (TaskOverview)

任务概览提供当前任务的简要信息，主要特点：

- 活跃任务计数和类型
- 任务进度指示
- 任务状态显示
- 简要的资源使用情况
- 查看详情链接

## 4. 实现技术

### 4.1 UI 框架

- PySide6 作为主要 UI 框架
- Qt 布局系统实现响应式设计
- Qt 样式表定制界面外观
- Qt 信号槽机制处理事件

### 4.2 线程与异步处理

- asyncio 与 Qt 事件循环集成
- 后台线程处理耗时操作
- 信号机制在线程间通信
- 任务队列管理并发任务

### 4.3 数据管理

- 配置读写和验证
- 会话状态保持
- 用户首选项管理
- 数据模型和视图分离

### 4.4 性能优化

- 延迟加载重量级组件
- 虚拟滚动处理大量数据
- 资源使用监控
- 内存管理和垃圾回收

## 5. 图形样式设计

### 5.1 主题系统

TG-Manager 使用 qt_material 库提供现代化 Material Design 风格的界面主题，支持多种主题切换：

- **主题类型**：

  - 浅色主题 (light_cyan.xml)
  - 深色主题 (dark_teal.xml) - 默认主题
  - 蓝色主题 (light_blue.xml)
  - 紫色主题 (dark_purple.xml)
  - 红色主题 (light_red.xml)
  - 绿色主题 (dark_lightgreen.xml)
  - 琥珀色主题 (light_amber.xml)
  - 粉色主题 (dark_pink.xml)
  - 黄色主题 (light_yellow.xml)
  - 青色主题 (dark_cyan.xml)

- **主题实现**：

  - 使用`ThemeManager`单例管理主题切换
  - 通过`apply_stylesheet`应用样式
  - 深色主题自动处理文本对比度优化
  - 支持实时预览和应用

- **主题特性**：
  - 圆角矩形元素
  - 扁平化设计
  - 鲜明的主色调
  - 适当的阴影效果
  - 符合 Material Design 规范的组件风格

### 5.2 主界面样式

主界面采用现代分割布局设计，视觉层次清晰：

- **菜单栏样式**：

  - 扁平化设计
  - 图标和文字组合
  - 悬停效果高亮
  - 子菜单层叠显示

- **工具栏样式**：

  - 可移动和自定义位置
  - 图标按钮配合简短文字标签
  - 增强图标可视性的背景色
  - 工具提示显示按钮功能

- **导航树样式**：

  - 层级缩进结构
  - 折叠/展开图标
  - 当前选中项高亮显示
  - 分组标题使用半透明灰色
  - 功能项使用对应功能的标志色

- **中央内容区样式**：

  - 浅色背景提高内容可读性
  - 欢迎页使用大尺寸半透明文字
  - 内容边缘适当留白，减少视觉压力
  - 功能视图切换时的平滑过渡效果

- **状态栏样式**：
  - 简洁信息展示
  - 图标指示系统状态
  - 进度指示区域使用进度条
  - 错误状态使用红色提示

### 5.3 下载界面样式

下载界面采用分区域卡片式布局，样式特点包括：

- **标签页样式**：

  - 标签页顶部带圆角
  - 活动标签使用主色调底色
  - 非活动标签使用灰色半透明效果
  - 标签切换平滑过渡动画

- **表单元素样式**：

  - 输入框带下划线或边框
  - 输入框获得焦点时主色调高亮
  - 提示文字使用浅色
  - 标签文本右对齐，增强可读性

- **按钮样式**：

  - 主操作按钮使用突出色
  - 次要操作按钮使用中性色
  - 圆角矩形设计
  - 悬停和点击时的反馈动画
  - 禁用状态使用半透明效果

- **进度显示样式**：
  - 进度条使用渐变色填充
  - 流畅的进度更新动画
  - 百分比文字叠加显示
  - 任务状态文字与进度同步变化

### 5.4 上传界面样式

上传界面结合文件浏览器和上传队列，样式特点包括：

- **文件浏览区样式**：

  - 树形结构文件夹显示
  - 文件图标对应文件类型
  - 当前路径面包屑导航
  - 选中文件高亮显示
  - 可拖放区域虚线框提示

- **选项面板样式**：

  - 分组框清晰划分功能区域
  - 复选框带动画效果
  - 滑块控件平滑拖动反馈
  - 数字输入框带微调按钮
  - 互斥选项样式区分

- **上传队列样式**：
  - 列表项带阴影边框
  - 交替行背景色增强可读性
  - 文件状态图标指示
  - 进度条实时更新
  - 错误状态红色高亮警示

### 5.5 转发界面样式

转发界面采用多列布局，样式特点包括：

- **频道配对列表样式**：

  - 卡片式频道对显示
  - 源频道和目标频道视觉连接
  - 状态指示图标使用颜色编码
  - 列表项鼠标悬停高亮效果
  - 可删除指示按钮显示

- **媒体过滤区样式**：

  - 复选框紧凑排列
  - 选中状态使用填充色显示
  - 图标辅助识别媒体类型
  - 分组视觉边界清晰

- **转发状态区样式**：
  - 实时进度信息卡片式展示
  - 整体进度和单条消息进度分离
  - 统计数据使用格式化显示
  - 错误消息使用警示色标记

### 5.6 监听界面样式

监听界面强调实时信息展示，样式特点包括：

- **配置区样式**：
  - 表单控件紧凑布局
  - 源目标频道对可视化连接
  - 文本替换规则直观展示
  - 关键参数高亮显示
- **消息流样式**：

  - 实时消息卡片自动滚动
  - 新消息动画过渡效果
  - 消息类型图标区分
  - 时间戳小字体显示
  - 消息预览区截断过长内容

- **统计区样式**：
  - 数据可视化图表直观展示
  - 数字计数器大字体显示
  - 分类统计使用颜色区分
  - 趋势变化使用箭头指示
  - 错误和警告信息突出显示

### 5.7 设置界面样式

设置界面遵循平台一致性，样式特点包括：

- **标签页组织样式**：

  - 左侧垂直标签页布局
  - 图标和文字组合的标签
  - 活动标签页视觉突出
  - 内容区域边框清晰分隔

- **设置项样式**：

  - 一致的表单布局结构
  - 标签文本与控件对齐
  - 工具提示提供帮助信息
  - 分组框逻辑分隔设置项
  - 必填项视觉标记

- **主题预览样式**：

  - 主题下拉列表实时预览
  - 颜色选择器展示色彩面板
  - 选中主题即时应用
  - 默认值视觉指示

- **操作按钮样式**：
  - 底部居中布局
  - 主操作按钮突出显示
  - 取消按钮次要样式
  - 恢复默认值按钮带警示色

### 5.8 任务管理器样式

任务管理器侧重信息密度和操作效率，样式特点包括：

- **任务列表样式**：

  - 紧凑表格布局
  - 可排序的表头
  - 任务类型使用图标区分
  - 状态列使用颜色编码
  - 进度条嵌入列表项

- **任务详情样式**：

  - 详情面板可折叠展开
  - 信息分组层次清晰
  - 关键参数大字体显示
  - 资源使用可视化图表
  - 操作按钮逻辑分组排列

- **过滤器样式**：
  - 组合过滤条件视觉分隔
  - 快速过滤按钮组
  - 搜索框即时过滤
  - 过滤状态指示器

### 5.9 日志查看器样式

日志查看器强调信息检索和阅读体验，样式特点包括：

- **日志列表样式**：

  - 多列表格显示信息
  - 日志级别颜色编码
  - 时间列格式化显示
  - 消息列自动换行
  - 单击展开详情

- **搜索过滤样式**：

  - 突出显示搜索工具栏
  - 即时过滤反馈
  - 高级搜索选项可折叠
  - 搜索结果计数显示
  - 匹配内容高亮标记

- **日志详情样式**：
  - 详情面板格式化展示
  - 复制按钮快速访问
  - 代码块样式显示技术信息
  - 折叠/展开长内容
  - 关联跳转链接

### 5.10 通用控件样式

所有界面共享一套统一的控件样式系统：

- **按钮样式**：

  ```css
  QPushButton {
    background-color: #2196f3;
    color: white;
    border: none;
    border-radius: 3px;
    padding: 4px 8px;
    font-weight: bold;
  }
  QPushButton:hover {
    background-color: #1976d2;
  }
  QPushButton:pressed {
    background-color: #0d47a1;
  }
  QPushButton:disabled {
    background-color: #b0bec5;
    color: #78909c;
  }
  ```

- **输入框样式**：

  ```css
  QLineEdit {
    border: 1px solid #bdbdbd;
    border-radius: 3px;
    padding: 4px;
    background-color: palette(base);
  }
  QLineEdit:focus {
    border: 1px solid #2196f3;
  }
  QLineEdit:disabled {
    background-color: #f5f5f5;
    color: #9e9e9e;
  }
  ```

- **进度条样式**：

  ```css
  QProgressBar {
    border: none;
    border-radius: 3px;
    text-align: center;
    background-color: #f5f5f5;
  }
  QProgressBar::chunk {
    background-color: #4caf50;
    border-radius: 2px;
  }
  ```

- **列表和表格样式**：

  ```css
  QListWidget,
  QTableWidget {
    border: 1px solid #e0e0e0;
    border-radius: 3px;
    alternate-background-color: rgba(60, 60, 60, 0.1);
  }
  QListWidget::item,
  QTableWidget::item {
    border-bottom: 1px solid rgba(100, 100, 100, 0.1);
    padding: 4px 2px;
  }
  QListWidget::item:selected,
  QTableWidget::item:selected {
    background-color: rgba(0, 120, 215, 0.6);
  }
  ```

- **分组框样式**：

  ```css
  QGroupBox {
    font-weight: bold;
    padding-top: 2px;
    margin-top: 0.5em;
    border: 1px solid #444;
    border-radius: 3px;
  }
  QGroupBox::title {
    subcontrol-origin: margin;
    subcontrol-position: top left;
    left: 7px;
    padding: 0 3px;
    background-color: palette(window);
  }
  ```

- **标签页样式**：
  ```css
  QTabWidget::pane {
    border: 1px solid #444;
    padding: 1px;
  }
  QTabBar::tab {
    padding: 3px 8px;
  }
  QTabBar::tab:selected {
    background-color: palette(highlight);
    color: palette(highlighted-text);
  }
  ```

## 6. 后续开发计划

以下是 TG-Manager 图形界面的后续开发计划：

1. **UI 改进**：
   - 进一步优化移动设备兼容性
   - 增加更多主题和自定义选项
   - 改进辅助功能支持
2. **功能扩展**：
   - 批量处理工具
   - 高级搜索功能
   - 定时任务支持
   - 更丰富的数据可视化
3. **性能优化**：
   - 提高大数据集处理效率
   - 减少内存占用
   - 优化启动速度
4. **多平台支持**：
   - 完善 Windows/Linux/macOS 兼容性
   - 考虑移动平台支持
   - 提供 Web 界面版本

## 7. 总结

TG-Manager 图形界面采用现代化设计理念和技术框架，提供直观、高效的用户体验。通过模块化和 MVP 架构设计，确保代码的可维护性和扩展性。界面设计注重用户体验，同时保证核心功能的完整性和易用性。当前实现覆盖了所有主要功能模块，为用户提供一站式 Telegram 消息和媒体管理解决方案。
