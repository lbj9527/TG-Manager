# TG Forwarder 图形界面设计规划

## 1. 总体设计

### 1.1 设计原则

- **简洁直观**：界面清晰，操作流程符合直觉
- **功能完备**：覆盖命令行版本的所有功能
- **响应式布局**：适应不同屏幕大小和分辨率
- **主题支持**：支持浅色/深色主题，遵循系统设置
- **多语言支持**：初期支持中文和英文，后续可扩展

### 1.2 总体架构

- 采用 PyQt6/PySide6 框架开发
- 遵循 Model-View-Presenter (MVP) 架构模式
- 使用 Qt Material 主题增强视觉体验
- 所有耗时操作放入独立线程，避免界面卡顿
- 实现 asyncio 与 Qt 事件循环集成

### 1.3 主界面布局

```
+-----------------------------------------------------------------------+
|  菜单栏 [文件] [配置] [工具] [视图] [帮助]                               |
+-----------------------------------------------------------------------+
|  工具栏 [登录] [设置] [任务管理器] [日志查看器]                           |
+-----------------------------------------------------------------------+
|                                                                       |
|  +-------------------+     +-----------------------------------+      |
|  |                   |     |                                   |      |
|  |  功能导航面板       |     |  功能操作区（根据选择的功能变化）     |      |
|  |                   |     |                                   |      |
|  |  - 历史消息转发     |     |                                   |      |
|  |  - 媒体文件下载     |     |                                   |      |
|  |  - 关键词媒体下载   |     |                                   |      |
|  |  - 本地文件上传     |     |                                   |      |
|  |  - 实时消息监听     |     |                                   |      |
|  |  - 系统设置        |     |                                   |      |
|  |                   |     |                                   |      |
|  +-------------------+     +-----------------------------------+      |
|                                                                       |
+-----------------------------------------------------------------------+
|  状态栏 [客户端状态] [任务进度] [网络状态]                               |
+-----------------------------------------------------------------------+
```

## 2. 功能模块界面

### 2.1 登录与身份验证界面

- **登录方式选择**：

  - API Key 登录（API ID 和 API Hash）
  - 会话字符串登录
  - Bot Token 登录

- **代理设置**：

  - 代理类型选择（无/SOCKS5/HTTP）
  - 代理地址和端口配置
  - 代理认证信息（可选）

- **身份验证流程**：
  - 手机号码输入框
  - 验证码输入框
  - 二步验证密码输入框（如有需要）
  - 记住会话选项

### 2.2 历史消息转发界面

- **源目标配置区**：

  - 源频道添加/删除/编辑按钮
  - 目标频道添加/删除/编辑按钮
  - 频道配对可视化展示

- **转发设置区**：

  - 消息 ID 范围设置（起始 ID、结束 ID）
  - 媒体类型选择（多选框）
  - 选项设置（隐藏作者、删除说明文字等）
  - 转发延迟设置（滑动条）

- **文本替换设置**：

  - 文本替换规则列表
  - 添加/编辑/删除规则按钮
  - 规则启用/禁用开关

- **媒体组设置**：

  - 媒体组处理方式选择
  - 媒体组重组选项
  - 媒体顺序维护选项

- **执行控制区**：
  - 开始/暂停/停止按钮
  - 进度条和状态信息
  - 预估完成时间
  - 频道权限检测指示器

### 2.3 媒体文件下载界面

- **下载源配置**：

  - 源频道列表（多选）
  - 消息 ID 范围设置
  - 媒体类型过滤器（多选框）

- **下载选项设置**：

  - 下载路径选择
  - 并行下载开关及并发数设置
  - 文件组织方式选择
    - 按频道分类
    - 按媒体组分类
    - 混合组织模式
  - 下载优先级设置

- **下载监控区**：

  - 活跃下载任务列表
  - 下载速度和剩余时间
  - 流量统计图表
  - 下载历史查看按钮
  - 当前并发下载数显示

- **文件浏览器**：
  - 已下载文件导航（树形结构）
  - 媒体预览功能
  - 文件操作菜单（打开/删除等）
  - 媒体组查看选项

### 2.3.1 关键词媒体下载界面

- **关键词配置区**：

  - 关键词列表管理（添加/编辑/删除）
  - 关键词优先级设置
  - 关键词分组功能
  - 关键词匹配规则设置（精确/模糊匹配）

- **下载源配置**：

  - 源频道选择（支持多选）
  - 消息 ID 范围设置
  - 按频道设置不同的关键词组

- **媒体类型选择**：

  - 媒体类型多选框
  - 按关键词设置媒体类型过滤

- **文件组织选项**：

  - 组织方式选择（按关键词/按频道/按日期）
  - 媒体组保持选项
  - 子目录命名规则设置

- **下载队列与监控**：

  - 匹配消息预览
  - 匹配关键词高亮显示
  - 下载进度和状态跟踪
  - 关键词命中统计

### 2.4 本地文件上传界面

- **目标频道配置**：

  - 目标频道选择列表
  - 频道权限状态指示
  - 智能排序开关
  - 分类标签功能

- **本地文件选择器**：

  - 文件目录树
  - 文件/文件夹拖放区域
  - 媒体预览窗格
  - 文件选择按钮
  - 媒体组自动识别功能

- **上传选项设置**：

  - 说明文字模板编辑器
  - 媒体组选项（是否分组上传）
  - 视频缩略图生成选项
    - 自动生成选项
    - 手动选择缩略图
    - 缩略图预览和编辑
  - 上传延迟设置
  - title.txt 说明文字自动识别选项

- **上传队列管理**：
  - 队列中的文件列表
  - 上传进度和状态
  - 取消/重试按钮
  - 文件排序功能
  - 智能频道选择状态

### 2.5 实时消息监听界面

- **监听配置区**：

  - 监听频道添加/删除按钮
  - 转发目标频道配置
  - 每个频道对单独配置选项
  - 监听截止日期设置
  - 转发延迟设置

- **消息过滤设置**：

  - 媒体类型过滤器（多选框）
  - 文本替换规则编辑器
    - 按频道设置不同规则
    - 规则测试功能
    - 批量导入导出规则
  - 说明文字处理选项
  - 媒体组处理设置
    - 媒体组整体处理模式开关
    - 媒体组排序选项

- **监听控制台**：

  - 开始/停止监听按钮
  - 监听状态和持续时间
  - 活跃监听频道列表
  - 按频道暂停/恢复选项
  - 频道指示灯（活跃/暂停/错误）

- **消息预览区**：

  - 最近收到的消息预览
    - 消息类型指示图标
    - 媒体组标记
    - 源频道标签
  - 转发状态指示
  - 消息详情查看按钮
  - 手动转发/跳过控制
  - 实时消息计数器

- **转发状态面板**：
  - 按频道分组的转发统计
  - 转发成功/失败/等待计数
  - 错误信息查看选项
  - 重新转发失败消息按钮

### 2.6 系统设置界面

- **应用设置**：

  - 界面语言选择
  - 主题选择（浅色/深色/跟随系统）
  - 启动选项（启动时自动连接等）
  - 文件默认保存路径
  - 媒体组默认处理策略

- **网络设置**：

  - 全局代理配置
  - 连接重试策略
  - 带宽限制选项
  - API 请求延迟设置
  - 自动重连设置

- **通知设置**：

  - 任务完成通知
  - 错误通知
  - 消息接收通知
  - 系统托盘行为
  - 声音提示选项

- **高级设置**：
  - 日志级别设置
  - 缓存大小限制
  - 数据库维护选项
  - 调试模式开关
  - 性能优化选项
  - 会话管理选项

## 3. 辅助功能界面

### 3.1 任务管理器

- 所有活跃任务列表（下载/上传/转发/监听）
- 任务优先级调整
- 资源使用情况监控
  - CPU/内存使用图表
  - 网络带宽使用图表
- 任务详情查看和控制选项
- 任务调度策略设置

### 3.2 日志查看器

- 分类日志选项卡（系统/下载/上传/转发/监听）
- 日志级别过滤器
- 日志搜索功能
  - 高级搜索条件设置
  - 正则表达式搜索支持
- 日志导出选项
- 日志自动清理设置

### 3.3 频道管理器

- 已保存频道列表
- 频道分组和标签功能
- 频道权限信息
  - 转发权限检测
  - 媒体上传限制检测
- 频道预览和测试功能
- 频道订阅信息管理

### 3.4 媒体预览器

- 图片、视频、文档等多媒体预览
- 缩略图生成工具
- 媒体信息展示
  - 文件大小、分辨率、编码等技术信息
  - 上传/下载日期、来源频道等元数据
- 简单编辑功能（裁剪、旋转等）
- 媒体组浏览功能

### 3.5 媒体组管理器

- 媒体组创建和编辑工具
- 从文件夹自动生成媒体组
- 媒体项拖放排序功能
- 统一标题/说明文字编辑
- 媒体组预览功能

## 4. 交互设计

### 4.1 拖放操作

- 拖放文件/文件夹到上传区域
- 在频道列表间拖放实现配对
- 任务拖放调整优先级
- 面板拖放自定义界面布局
- 媒体文件拖放重组媒体组

### 4.2 快捷键支持

- 常用操作快捷键（Ctrl+S 保存配置等）
- 面板切换快捷键（Ctrl+1, Ctrl+2 等）
- 任务控制快捷键（F5 开始, Esc 停止等）
- 自定义快捷键配置
- 全局快捷键支持（可选）

### 4.3 上下文菜单

- 频道右键菜单（编辑、删除、测试等）
- 文件右键菜单（预览、编辑说明文字等）
- 任务右键菜单（暂停、取消、查看详情等）
- 日志右键菜单（复制、保存、清除等）
- 媒体组右键菜单（重组、分离、合并等）

### 4.4 工具提示

- 控件功能提示
- 状态信息详细说明
- 错误原因提示
- 最佳实践建议
- 键盘快捷键提示

### 4.5 批处理操作

- 多文件/文件夹批量上传
- 多频道批量配置
- 批量文本替换规则导入
- 媒体组批量处理选项

## 5. 视觉设计

### 5.1 主题与风格

- **默认主题**：遵循 Material Design 设计规范
- **备选主题**：暗色主题、高对比度主题
- **自定义元素**：Telegram 风格的消息气泡和图标
- **颜色方案**：主色调与 Telegram 品牌色保持一致
- **配色选项**：用户可自定义主要界面元素颜色

### 5.2 图标与可视化元素

- 功能区分明显的图标系统
- 状态指示图标（活跃、暂停、错误等）
- 进度可视化（环形进度、波形图等）
- 数据可视化图表（速度曲线、资源使用率等）
- 媒体类型识别图标

### 5.3 响应式设计

- 支持窗口大小调整，内容自适应
- 面板可折叠，适应小屏幕设备
- 控件尺寸根据屏幕分辨率自动调整
- 支持高 DPI 显示器
- 移动设备优化布局（可选）

### 5.4 动画与过渡效果

- 面板切换平滑过渡
- 任务状态变化动画
- 提示信息淡入淡出
- 加载过程动画
- 媒体预览过渡效果

### 5.5 消息样式与预览

- Telegram 风格消息气泡
- 媒体缩略图预览
- 消息状态指示器
- 转发链接可视化
- 媒体组展示样式

## 6. 实现路线图

### 6.1 第一阶段：基础框架

- PyQt6/PySide6 环境搭建
- 主界面布局实现
- 基本导航功能
- Telegram 客户端集成
- 配置管理系统

### 6.2 第二阶段：核心功能

- 历史消息转发界面
- 媒体文件下载界面
- 关键词下载界面
- 本地文件上传界面
- 实时消息监听界面

### 6.3 第三阶段：辅助功能

- 任务管理器
- 日志查看器
- 频道管理器
- 媒体预览器
- 媒体组管理工具

### 6.4 第四阶段：优化与完善

- 性能优化
- 界面美化
- 多语言支持
- 打包与部署
- 用户反馈系统

### 6.5 第五阶段：高级功能

- 批处理自动化功能
- 定时任务系统
- 插件系统实现
- 高级数据分析工具
- 云同步功能（可选）

## 7. 注意事项与限制

### 7.1 平台兼容性

- Windows、macOS、Linux 跨平台支持
- 最低系统版本要求
- 特定平台优化（如 macOS 原生菜单）
- 移动平台可能性评估
- 安装包与便携版选项

### 7.2 性能考量

- 大型媒体处理时的内存管理
- 长时间运行的稳定性优化
- 并发任务数量限制
- 资源占用监控与管理
- 大文件处理策略

### 7.3 安全与隐私

- API 密钥安全存储
- 会话信息加密
- 日志中敏感信息处理
- 错误报告内容控制
- 本地数据保护

### 7.4 用户体验改进

- 用户反馈收集机制
- 使用统计（可选且匿名）
- 引导教程与上下文帮助
- 常见问题自动检测与建议
- 功能发现辅助系统

### 7.5 Telegram API 限制处理

- 速率限制智能管理
- 自动退避策略
- API 更新兼容性维护
- 功能可用性动态检测
- 错误处理与用户提示
