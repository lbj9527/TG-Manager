# TG-Manager 用户界面设计文档

## 1. 概述

本文档描述了 TG-Manager（Telegram 消息转发工具）的用户界面设计方案。TG-Manager 提供历史消息转发、媒体文件下载、本地文件上传以及实时消息监听等功能，界面设计旨在提供直观、高效且用户友好的操作体验。

## 2. 技术选型

- **框架**: PyQt6/PySide6
- **设计风格**: Material Design (使用 Qt-Material 库)
- **主题支持**: 深色/浅色模式，支持自动跟随系统主题
- **多语言**: 支持中文和英文界面切换
- **布局**: 响应式设计，适应不同屏幕尺寸

## 3. 界面结构

TG-Manager 采用分页标签式主界面结构，包含以下主要组件：

### 3.1 主窗口结构

```
+--------------------------------------------------------------+
|                         应用标题栏                            |
+--------------------------------------------------------------+
|       |                                           |          |
|       |                                           |  状态面板 |
|       |                                           |          |
|       |                                           |  • 连接状态|
| 侧边栏 |                  内容区域                  |  • 任务队列|
|       |                                           |  • 日志预览|
|       |                                           |          |
|       |                                           |          |
|       |                                           |          |
+--------------------------------------------------------------+
|                          状态栏                              |
+--------------------------------------------------------------+
```

### 3.2 侧边栏导航

侧边栏提供主要功能模块导航：

- **主页/概览**：显示系统概况、活动状态
- **历史消息转发**：配置和执行历史消息转发任务
- **媒体文件下载**：配置和执行媒体文件下载任务
- **本地文件上传**：管理和执行本地文件上传任务
- **实时消息监听**：配置和启动实时消息监听
- **配置管理**：编辑应用配置
- **历史记录**：查看操作历史记录
- **设置**：应用全局设置

每个导航项目包含图标和文本标签，选中状态有明显的视觉指示。

## 4. 页面设计

### 4.1 主页/概览

```
+--------------------------------------------------------------+
|                         主页/概览                             |
+--------------------------------------------------------------+
|                                                              |
|  +------------------+  +------------------+  +-------------+ |
|  |    转发任务统计   |  |    下载任务统计   |  |  上传任务统计 | |
|  |  • 总任务数: XX   |  |  • 总任务数: XX   |  | • 总任务数: XX| |
|  |  • 成功: XX       |  |  • 成功: XX       |  | • 成功: XX    | |
|  |  • 失败: XX       |  |  • 失败: XX       |  | • 失败: XX    | |
|  +------------------+  +------------------+  +-------------+ |
|                                                              |
|  +---------------------------------------------------------+ |
|  |                       活动监控                           | |
|  |                                                         | |
|  |  [实时监控图表 - 显示当前活动任务、资源占用等]            | |
|  |                                                         | |
|  +---------------------------------------------------------+ |
|                                                              |
|  +---------------------------------------------------------+ |
|  |                     快速任务启动                         | |
|  |                                                         | |
|  |  [转发] [下载] [上传] [监听]                             | |
|  |                                                         | |
|  +---------------------------------------------------------+ |
|                                                              |
+--------------------------------------------------------------+
```

### 4.2 历史消息转发

```
+--------------------------------------------------------------+
|                      历史消息转发                             |
+--------------------------------------------------------------+
|                                                              |
|  +---------------------------------------------------------+ |
|  |                 频道映射关系配置                        | |
|  |                                                         | |
|  | 源频道: [下拉选择] 或 [输入频道ID/链接/用户名]            | |
|  |                                                         | |
|  | 目标频道列表:                                           | |
|  | +----------------+ +----------------+ [添加目标频道]    | |
|  | | @channel1      | | @channel2      |                  | |
|  | +----------------+ +----------------+                  | |
|  |                                                         | |
|  | [添加映射] [删除映射]                                    | |
|  +---------------------------------------------------------+ |
|                                                              |
|  +---------------------------------------------------------+ |
|  |                      转发设置                           | |
|  |                                                         | |
|  | 起始消息ID: [____] 结束消息ID: [____]                    | |
|  |                                                         | |
|  | 媒体类型: [√] 图片 [√] 视频 [√] 文档 [√] 音频 [√] 动画   | |
|  |                                                         | |
|  | [√] 移除标题  [√] 隐藏作者                              | |
|  |                                                         | |
|  | 转发延迟(秒): [____]                                     | |
|  +---------------------------------------------------------+ |
|                                                              |
|  +---------------------------------------------------------+ |
|  |                 频道映射列表                             | |
|  |                                                         | |
|  | [表格显示已配置的频道映射关系]                           | |
|  |                                                         | |
|  | 源频道            目标频道              状态            | |
|  | --------------  ------------------  --------------     | |
|  | @source1        @target1,@target2   待转发            | |
|  | @source2        @target3            转发中...          | |
|  |                                                         | |
|  +---------------------------------------------------------+ |
|                                                              |
|  [启动转发] [停止转发] [保存配置]                             |
|                                                              |
+--------------------------------------------------------------+
```

### 4.3 媒体文件下载

```
+--------------------------------------------------------------+
|                      媒体文件下载                             |
+--------------------------------------------------------------+
|                                                              |
|  +---------------------------------------------------------+ |
|  |                     下载源配置                           | |
|  |                                                         | |
|  | 源频道列表:                                             | |
|  | +----------------+ +----------------+ [添加源频道]      | |
|  | | @channel1      | | @channel2      |                  | |
|  | +----------------+ +----------------+                  | |
|  |                                                         | |
|  +---------------------------------------------------------+ |
|                                                              |
|  +---------------------------------------------------------+ |
|  |                     下载设置                            | |
|  |                                                         | |
|  | 起始消息ID: [____] 结束消息ID: [____]                    | |
|  |                                                         | |
|  | 媒体类型: [√] 图片 [√] 视频 [√] 文档 [√] 音频 [√] 动画   | |
|  |                                                         | |
|  | 下载路径: [__________________] [浏览]                    | |
|  |                                                         | |
|  | [√] 按聊天分类保存  [√] 并行下载                         | |
|  |                                                         | |
|  | 最大并发下载数: [10___]                                  | |
|  +---------------------------------------------------------+ |
|                                                              |
|  +---------------------------------------------------------+ |
|  |                     下载任务                            | |
|  |                                                         | |
|  | [进度条显示总体下载进度]                                 | |
|  |                                                         | |
|  | 任务ID  源频道   文件名      大小    进度     状态      | |
|  | ------ -------  ---------- ------- -------- ---------  | |
|  | 001    @chan1   photo.jpg  1.2MB   100%     完成       | |
|  | 002    @chan2   video.mp4  15.4MB  45%      下载中     | |
|  |                                                         | |
|  +---------------------------------------------------------+ |
|                                                              |
|  [启动下载] [暂停下载] [取消下载] [保存配置]                  |
|                                                              |
+--------------------------------------------------------------+
```

### 4.4 本地文件上传

```
+--------------------------------------------------------------+
|                      本地文件上传                             |
+--------------------------------------------------------------+
|                                                              |
|  +---------------------------------------------------------+ |
|  |                  目标频道配置                           | |
|  |                                                         | |
|  | 目标频道列表:                                           | |
|  | +----------------+ +----------------+ [添加目标频道]    | |
|  | | @channel1      | | @channel2      |                  | |
|  | +----------------+ +----------------+                  | |
|  |                                                         | |
|  +---------------------------------------------------------+ |
|                                                              |
|  +---------------------------------------------------------+ |
|  |                    上传设置                             | |
|  |                                                         | |
|  | 上传目录: [__________________] [浏览]                    | |
|  |                                                         | |
|  | 标题模板: [________________]                             | |
|  |                                                         | |
|  | [√] 生成视频缩略图   [√] 保留文件名作为标题               | |
|  |                                                         | |
|  +---------------------------------------------------------+ |
|                                                              |
|  +---------------------------------------------------------+ |
|  |                 本地文件管理                             | |
|  |                                                         | |
|  | [文件夹树状视图]        [文件预览]                       | |
|  | +-----------------+    +------------------------+       | |
|  | | uploads/        |    | [选中文件的预览]       |       | |
|  | | ├─ 媒体组1/     |    |                        |       | |
|  | | │  ├─ 1.jpg     |    | 文件名: photo.jpg      |       | |
|  | | │  └─ 2.mp4     |    | 类型: 图片             |       | |
|  | | └─ 媒体组2/     |    | 大小: 1.2MB            |       | |
|  | |    ├─ 1.jpg     |    |                        |       | |
|  | |    └─ 2.jpg     |    |                        |       | |
|  | +-----------------+    +------------------------+       | |
|  |                                                         | |
|  | [添加文件] [创建媒体组] [删除] [刷新]                    | |
|  +---------------------------------------------------------+ |
|                                                              |
|  [启动上传] [暂停上传] [取消上传] [保存配置]                  |
|                                                              |
+--------------------------------------------------------------+
```

### 4.5 实时消息监听

```
+--------------------------------------------------------------+
|                    实时消息监听                               |
+--------------------------------------------------------------+
|                                                              |
|  +---------------------------------------------------------+ |
|  |                 监听频道映射配置                         | |
|  |                                                         | |
|  | 源频道: [下拉选择] 或 [输入频道ID/链接/用户名]            | |
|  |                                                         | |
|  | 目标频道列表:                                           | |
|  | +----------------+ +----------------+ [添加目标频道]    | |
|  | | @channel1      | | @channel2      |                  | |
|  | +----------------+ +----------------+                  | |
|  |                                                         | |
|  | [添加映射] [删除映射]                                    | |
|  +---------------------------------------------------------+ |
|                                                              |
|  +---------------------------------------------------------+ |
|  |                     监听设置                            | |
|  |                                                         | |
|  | 媒体类型: [√] 图片 [√] 视频 [√] 文档 [√] 音频 [√] 动画   | |
|  |                                                         | |
|  | [√] 移除标题                                            | |
|  |                                                         | |
|  | 转发延迟(秒): [____]                                     | |
|  |                                                         | |
|  | 监听持续时间: [____] (为空表示持续监听)                   | |
|  +---------------------------------------------------------+ |
|                                                              |
|  +---------------------------------------------------------+ |
|  |                  活动监听任务                           | |
|  |                                                         | |
|  | 源频道         目标频道             状态     接收/转发   | |
|  | ------------ ------------------ ---------- ----------  | |
|  | @source1     @target1,@target2  监听中     12/10       | |
|  | @source2     @target3           已停止     5/5         | |
|  |                                                         | |
|  | [详细日志区域 - 显示监听事件和转发状态]                   | |
|  |                                                         | |
|  +---------------------------------------------------------+ |
|                                                              |
|  [启动监听] [停止监听] [保存配置]                             |
|                                                              |
+--------------------------------------------------------------+
```

### 4.6 配置管理

```
+--------------------------------------------------------------+
|                      配置管理                                |
+--------------------------------------------------------------+
|                                                              |
|  +---------------------------------------------------------+ |
|  |                    通用配置                             | |
|  |                                                         | |
|  | API ID: [___________]  API Hash: [___________________]  | |
|  |                                                         | |
|  | 操作限制: [____] 条消息   暂停时间: [____] 秒            | |
|  |                                                         | |
|  | 超时时间: [____] 秒      最大重试次数: [____]            | |
|  +---------------------------------------------------------+ |
|                                                              |
|  +---------------------------------------------------------+ |
|  |                   代理设置                              | |
|  |                                                         | |
|  | [√] 启用代理                                            | |
|  |                                                         | |
|  | 代理类型: [SOCKS5▼]                                     | |
|  |                                                         | |
|  | 代理地址: [____________]  端口: [_____]                  | |
|  |                                                         | |
|  | 用户名: [____________]  密码: [____________]              | |
|  +---------------------------------------------------------+ |
|                                                              |
|  +---------------------------------------------------------+ |
|  |               配置文件操作                              | |
|  |                                                         | |
|  | 配置文件: [config.json_________________] [浏览]          | |
|  |                                                         | |
|  | [导入配置] [导出配置] [恢复默认配置]                      | |
|  +---------------------------------------------------------+ |
|                                                              |
|  [保存配置] [取消]                                           |
|                                                              |
+--------------------------------------------------------------+
```

### 4.7 历史记录

```
+--------------------------------------------------------------+
|                      历史记录                                |
+--------------------------------------------------------------+
|                                                              |
|  [下载历史] [上传历史] [转发历史]                              |
|                                                              |
|  +---------------------------------------------------------+ |
|  |                 历史记录查看器                           | |
|  |                                                         | |
|  | [搜索/筛选工具栏]                                       | |
|  |                                                         | |
|  | 频道/文件            操作时间           状态            | |
|  | ----------------- ------------------ --------------    | |
|  | @channel1: #12345  2023-06-15 08:30   完成             | |
|  | video.mp4          2023-06-15 09:15   失败             | |
|  | @channel2: #67890  2023-06-16 10:45   完成             | |
|  |                                                         | |
|  | [分页导航]                                              | |
|  +---------------------------------------------------------+ |
|                                                              |
|  +---------------------------------------------------------+ |
|  |                 详细信息                                | |
|  |                                                         | |
|  | [显示选定记录的详细信息]                                 | |
|  |                                                         | |
|  +---------------------------------------------------------+ |
|                                                              |
|  [导出历史记录] [清除历史记录]                                |
|                                                              |
+--------------------------------------------------------------+
```

### 4.8 设置

```
+--------------------------------------------------------------+
|                       设置                                   |
+--------------------------------------------------------------+
|                                                              |
|  +---------------------------------------------------------+ |
|  |                  界面设置                               | |
|  |                                                         | |
|  | 主题: [浅色▼]  颜色方案: [蓝色▼]                         | |
|  |                                                         | |
|  | 语言: [中文▼]                                           | |
|  |                                                         | |
|  | [√] 跟随系统深色/浅色模式                                | |
|  +---------------------------------------------------------+ |
|                                                              |
|  +---------------------------------------------------------+ |
|  |                   日志设置                              | |
|  |                                                         | |
|  | 日志级别: [INFO▼]                                       | |
|  |                                                         | |
|  | 日志保留天数: [____]                                     | |
|  |                                                         | |
|  | 日志目录: [logs/___________________] [浏览]               | |
|  +---------------------------------------------------------+ |
|                                                              |
|  [应用设置] [取消] [恢复默认设置]                             |
|                                                              |
+--------------------------------------------------------------+
```

## 5. 状态面板

状态面板位于主界面右侧，提供应用运行状态的快速概览：

```
+-------------------------------+
|          状态面板             |
+-------------------------------+
|                               |
|  连接状态: ● 已连接            |
|                               |
|  活动任务: 2                  |
|                               |
|  转发: 1                      |
|  下载: 1                      |
|  上传: 0                      |
|  监听: 0                      |
|                               |
+-------------------------------+
|                               |
|  最近日志:                    |
|  [16:30:45] 下载任务启动      |
|  [16:31:12] 已下载: photo.jpg |
|  [16:32:05] 警告: 速率限制    |
|                               |
|  [查看完整日志]               |
|                               |
+-------------------------------+
|                               |
|  系统资源:                    |
|  CPU: 25%                     |
|  内存: 128MB                  |
|  网络: ↑2KB/s ↓150KB/s        |
|                               |
+-------------------------------+
```

## 6. 对话框和弹窗

### 6.1 登录对话框

```
+----------------------------------------------+
|                Telegram 登录                 |
+----------------------------------------------+
|                                              |
|  请输入您的 Telegram 账号信息:               |
|                                              |
|  手机号码: [+___________________]            |
|                                              |
|  [发送验证码]                                |
|                                              |
|  验证码: [______]                            |
|                                              |
|  [登录] [取消]                               |
|                                              |
+----------------------------------------------+
```

### 6.2 任务进度对话框

```
+----------------------------------------------+
|                任务进度                      |
+----------------------------------------------+
|                                              |
|  [进度条]                                    |
|                                              |
|  正在处理: message_id: 12345                 |
|                                              |
|  已完成: 45/100                              |
|                                              |
|  预计剩余时间: 5分钟                         |
|                                              |
|  [取消任务]                                  |
|                                              |
+----------------------------------------------+
```

### 6.3 错误提示对话框

```
+----------------------------------------------+
|                 错误提示                     |
+----------------------------------------------+
|                                              |
|  ⚠️ 操作失败                                 |
|                                              |
|  无法连接到目标频道 @channel                 |
|  错误代码: PEER_ID_INVALID                  |
|                                              |
|  可能原因:                                   |
|  - 频道不存在                                |
|  - 您没有访问此频道的权限                     |
|  - 账号被限制                                |
|                                              |
|  [重试] [忽略] [帮助]                        |
|                                              |
+----------------------------------------------+
```

### 6.4 频道选择器对话框

```
+----------------------------------------------+
|               选择频道                       |
+----------------------------------------------+
|                                              |
|  搜索: [_________________]                   |
|                                              |
|  最近访问:                                   |
|  ○ @channel1                                 |
|  ○ @channel2                                 |
|                                              |
|  您的频道:                                   |
|  ○ @your_channel1                            |
|  ○ @your_channel2                            |
|                                              |
|  加入的群组:                                 |
|  ○ @group1                                   |
|  ○ @group2                                   |
|                                              |
|  [确定] [取消]                               |
|                                              |
+----------------------------------------------+
```

## 7. 交互设计

### 7.1 拖放功能

- 支持将本地文件拖放到上传区域
- 支持在频道列表中拖动排序
- 支持媒体组内文件拖动排序

### 7.2 右键菜单

- 文件列表支持右键菜单(预览、删除、重命名等)
- 频道列表支持右键菜单(查看详情、复制链接、移除等)
- 任务列表支持右键菜单(暂停、恢复、取消、查看详情等)

### 7.3 键盘快捷键

- Ctrl+N: 新建任务
- Ctrl+S: 保存配置
- Ctrl+R: 刷新列表
- F5: 开始任务
- Esc: 取消/关闭当前对话框

## 8. 响应式设计

- 支持窗口大小调整，各组件自适应布局
- 支持最小化到系统托盘
- 支持分屏操作和多显示器环境

## 9. 通知系统

### 9.1 系统托盘通知

- 任务完成通知
- 错误和警告通知
- 新消息接收通知(监听模式)

### 9.2 应用内通知

- 状态变更提示
- 操作完成提示
- 错误和警告提示

## 10. 主题样式

### 10.1 浅色主题预览

浅色主题采用白底深色文字，强调色为蓝色，表单控件采用简洁的线框风格。

### 10.2 深色主题预览

深色主题采用深灰底白色文字，强调色为青蓝色，降低整体亮度，减轻长时间使用的视觉疲劳。

## 11. 实现计划

### 第一阶段：基础框架

1. 创建主窗口和侧边栏导航
2. 实现标签页切换机制
3. 建立基本状态面板

### 第二阶段：核心功能页面

1. 实现转发配置界面
2. 实现下载配置界面
3. 实现上传配置界面
4. 实现监听配置界面

### 第三阶段：设置与历史记录

1. 实现配置管理页面
2. 实现历史记录查看页面
3. 实现应用设置页面

### 第四阶段：美化与优化

1. 应用 Material Design 样式
2. 实现深色/浅色主题切换
3. 优化响应式布局
4. 添加动画效果

### 第五阶段：测试与完善

1. 功能测试与修复
2. 用户体验优化
3. 性能优化
4. 文档完善

## 12. 附录

### 12.1 UI 控件库

- QMainWindow: 主窗口
- QTabWidget: 标签页容器
- QTreeView: 目录树结构
- QTableView: 表格数据显示
- QListView: 列表显示
- QProgressBar: 进度条
- QStatusBar: 状态栏
- QDockWidget: 可停靠窗口
- QSystemTrayIcon: 系统托盘图标

### 12.2 自定义控件

- ChannelSelector: 频道选择器
- MediaPreview: 媒体文件预览组件
- TaskMonitor: 任务监控组件
- LogViewer: 日志查看器
