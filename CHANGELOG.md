# TG-Manager 更新日志

## 1.8.5 - 2025-04-05

### 功能增强

- **会话自动重连功能优化**:

  - 修复了会话自动重连功能的配置保存问题，确保重连设置能正确保存到配置文件中
  - 完善了`UIGeneralConfig`类中的`auto_restart_session`参数配置，默认值设为`True`
  - 优化了`create_default_config`函数，确保默认配置中包含自动重连参数
  - 更新了设置界面中的`_collect_settings`方法，使其能够正确收集自动重连状态
  - 增强了配置加载功能，确保从配置文件正确读取自动重连设置
  - 修改了应用默认配置，即使在加载配置失败时也会创建包含自动重连参数的默认设置
  - 提高了系统稳定性，使 Telegram 会话在意外断开后能够根据用户设置自动重新连接

- **网络代理界面优化**:
  - 简化了网络代理类型设置，仅保留 SOCKS5 代理类型选项
  - 优化了代理类型设置界面，降低用户设置复杂度
  - 调整了代理类型处理逻辑，确保所有代理连接使用可靠的 SOCKS5 协议
  - 提高了代理连接的稳定性和兼容性

## 1.8.4 - 2025-04-05

### 功能增强

- **自动配置创建功能**:
  - 新增程序首次启动时自动创建默认配置文件的功能，解决无配置文件导致程序无法启动的问题
  - 默认配置包含完整的配置结构和示例值，使新用户能够直接通过设置界面修改并保存配置
  - 改进了 ConfigManager 和 UIConfigManager 配置加载逻辑，确保在配置文件不存在时能自动创建
  - 增强了程序的容错性，避免在首次运行时因缺少配置文件而出现错误
  - 优化了用户首次使用体验，提供了更友好的初始化流程

### 修复

- **本地上传功能修复**:

  - 修复了本地上传界面中文件夹路径没有从配置文件中加载和保存的问题
  - 改进上传配置保存逻辑，现在会正确保存用户选择的文件夹路径
  - 优化上传界面加载时的路径初始化，确保从配置中读取的路径能正确应用到文件选择器
  - 确保文件浏览器和文件列表显示与配置中保存的路径一致
  - 增强用户体验，使上传路径配置持久化，不再需要每次启动时重新选择目录

- **路径验证修复**:
  - 修复了路径验证中不允许 Windows 风格路径（包含盘符如 D:）的问题
  - 改进配置验证器，移除对冒号字符的限制，允许 Windows 盘符格式
  - 优化了下载路径、上传目录和临时文件路径的验证逻辑
  - 保留对真正非法字符（如<>"|?\*）的检查，确保路径有效性
  - 确保在所有操作系统下都能正确验证和保存路径配置

## 1.8.3 - 2025-04-04

### 功能改进

- **配置文件权限问题处理**:

  - 增强了应用对只读配置文件的检测和处理能力
  - 当检测到配置文件无法写入时，显示明确的错误对话框，提示用户修改文件权限
  - 改进权限错误提示，提供具体解决方案，包括取消文件只读属性、以管理员身份运行程序或移动到有写入权限的目录
  - 优化程序启动流程，在初始化阶段即检查配置文件权限，避免运行中突然出现权限问题
  - 完善错误对话框后的程序退出机制，确保用户点击确认后程序能立即退出，便于用户修改文件权限
  - 统一应用内所有配置保存操作的权限错误处理逻辑，保持一致的用户体验

- **界面显示优化**:

  - 优化程序启动时的窗口位置，使主窗口在屏幕中央居中显示
  - 提升首次启动应用时的用户体验，避免窗口出现在屏幕角落

- **系统托盘功能优化**:
  - 实现了"启动时最小化"功能，允许程序启动后自动最小化到系统托盘
  - 该功能需要同时启用"最小化到托盘"选项，确保托盘图标可用
  - 优化托盘通知机制，在程序启动时以托盘形式运行时显示友好提示
  - 用户可以通过点击托盘图标或托盘菜单中的"显示主窗口"选项来显示主界面
  - 增强托盘图标的可靠性，确保在各种启动场景下都能正确显示

### 修复

- **系统托盘功能修复**:

  - 修复了设置界面中"最小化到托盘"选项不生效的问题
  - 实现完整的系统托盘支持，允许应用在最小化时隐藏到系统托盘
  - 添加托盘图标菜单，提供"显示主窗口"和"退出"选项
  - 优化托盘图标交互，支持双击或单击托盘图标恢复窗口
  - 添加窗口最小化事件处理，使最小化行为符合用户设置
  - 退出应用程序时自动清理系统托盘图标
  - 修复了窗口状态变化处理代码中的 QEvent 枚举引用错误，确保最小化到托盘功能正常工作

- **权限错误处理优化**:
  - 修复了配置文件为只读时可能弹出多个相同权限错误提示框的问题
  - 添加错误提示状态跟踪，确保权限错误对话框只显示一次
  - 改进权限错误处理逻辑，避免重复执行错误处理流程

### 代码优化

- **错误处理机制改进**:
  - 重构配置保存相关代码，正确捕获和处理权限错误（PermissionError）
  - 改进错误消息传递机制，确保错误信息能清晰地显示给用户
  - 优化日志记录，更详细地记录配置文件权限问题，便于问题排查
  - 重构应用程序退出流程，确保在出现严重错误时能够优雅退出
  - 增强 UIConfigManager 配置检查能力，在保存配置前主动验证文件写入权限

## 1.8.2 - 2025-04-03

### 修复

- **设置界面错误修复**:
  - 修复了设置界面中保存设置时出现的 "local variable 'logger' referenced before assignment" 错误
  - 优化异常处理逻辑，直接使用外部定义的 logger 变量，避免重复定义
  - 增强设置保存功能的稳定性和可靠性

## 1.8.1 - 2025-04-03

### 配置改进

- 简化配置文件结构，将 API 和代理设置整合到 GENERAL 部分中
- 删除了冗余的 API 和 PROXY 部分，提高配置一致性
- 保持向后兼容，仍然能够读取旧版本配置文件
- 优化设置界面，移除了通用标签页，因为相关设置已在各功能模块中单独设置
- 从 GENERAL 部分移除了重复的配置参数（如 download_path, max_concurrent_downloads 等），这些参数已在各自专门的模块配置中定义
- 精简 DOWNLOAD 部分的配置项，只保留 downloadSetting 数组、download_path、parallel_download 和 max_concurrent_downloads 参数

### 界面优化

- **下载界面改进**:
  - 将媒体类型选项从"下载选项"标签页移至"频道配置"标签页中关键词行的下方
  - 修改频道显示格式，在添加频道后显示更丰富的信息：链接、ID 范围、关键词和媒体类型
  - 优化配置加载逻辑，从 downloadSetting 数组的每个条目中单独读取媒体类型
  - 每个频道支持独立设置不同的媒体类型，提高灵活性

### 修复

- **主题设置保存问题修复**:

  - 修复了在设置界面更改主题后，关闭应用程序时主题设置被重置的问题
  - 改进了应用程序关闭时的配置保存逻辑，确保在保存窗口状态时不会覆盖主题设置
  - 优化了程序关闭时的保存行为，关闭程序时不再自动保存所有配置，只保存窗口布局状态
  - 明确区分了需要手动保存的配置（如主题、一般设置等）和自动保存的布局状态（如工具栏位置）
  - 修改了`_on_config_saved`方法处理窗口状态变化的逻辑，使其只保存窗口几何信息和状态，不影响其他配置
  - 增强了配置保存的健壮性，避免在保存特定配置项时意外覆盖其他配置
  - 添加了更详细的日志记录，便于跟踪配置保存过程和问题诊断

- **配置保存问题修复**:

  - 修复了下载配置无法正确保存到 config.json 文件的问题
  - 集成 UIConfigManager 类处理配置的加载、保存和转换，确保正确处理媒体类型等枚举值
  - 优化配置信号处理机制，确保从各视图发送的配置更新能正确保存
  - 修改 TGManagerApp 类中的 \_on_config_saved 方法，使其能正确接收和处理包含配置数据的信号
  - 改进 DownloadView 类的 \_save_config 方法，确保媒体类型的有效性和一致性
  - 增强配置系统的健壮性，增加错误处理和日志记录
  - 实现配置保存时的类型验证，避免因类型错误导致的保存失败

- **配置验证错误修复**:

  - 修复了启动时可能出现的配置验证错误，增强应用稳定性
  - 改进 UIConfigManager 中的配置转换逻辑，添加详细的错误处理
  - 增强对无效频道链接格式的容错能力，特别是私有频道链接的处理
  - 自动修复过期的监听截止日期，设置为未来日期
  - 修复 API ID 和 API Hash 格式验证问题，提供有效的默认占位符
  - 增强配置加载流程的错误处理，确保在配置无效时能优雅降级到默认配置
  - 添加更详细的错误日志，便于排查配置问题

- **UI 配置系统统一化**:
  - 创建 UIUIConfig 配置模型，将 UI 设置纳入统一的配置验证体系
  - 移除分散的 UI 配置加载与保存逻辑，改用统一的配置管理机制
  - 优化 UI 配置与其他配置的一致性，确保所有配置都通过相同的路径处理
  - 强化 UI 设置的验证和错误处理，包括主题名称、窗口位置和布尔值字段
  - 改进主题切换逻辑，确保主题设置在保存和应用之间保持一致性
  - 增强窗口状态保存机制，避免窗口位置和工具栏布局在应用重启后丢失

本文档记录 TG-Manager 项目的所有重要变更。

## [1.7.5] - 2025-04-02

### 界面改进

- **导航结构优化**:

  - 移除导航树中的关键词下载选项，与版本 0.7.2 中的功能一致
  - 统一普通下载和关键词下载的界面，使用同一个下载界面处理所有下载需求
  - 在频道配置标签卡中集成关键词筛选功能，用户可为每个频道配置单独的关键词
  - 简化用户操作流程，减少界面复杂度
  - 优化导航树布局，使核心功能更加突出
  - 保留核心功能模块：媒体下载、媒体上传、消息转发和消息监听

- **主题设置保存机制优化**:

  - 修复了可能自动保存主题设置的问题，现在只有在点击设置界面的"保存设置"按钮后才会保存主题更改
  - 在设置界面中更改主题时，立即预览主题效果，但只有点击保存按钮后才会永久应用主题设置
  - 优化了应用程序关闭时的配置保存逻辑，确保不会自动保存未经确认的主题设置
  - 保留窗口状态和其他设置的自动保存功能，不影响其他配置项的正常保存
  - 实现更加一致的用户体验，主题设置的更改行为现在与其他设置的行为保持一致

- **普通下载界面优化**:

  - 调整下载选项标签卡布局，将下载路径设置项移至标签卡底部
  - 减少媒体类型选项上下留白，优化垂直空间使用
  - 调整控件间距和对齐方式，使内容靠上显示，提高信息密度
  - 添加弹性空间，确保界面元素分布合理，即使在较小窗口下也能良好显示
  - 添加适当的空间间隔，使界面元素排布更加合理
  - 优化用户操作流程，提高界面的直观性和一致性
  - 重构频道配置选项卡的布局，使用垂直分割器分隔频道列表和关键词部分
  - 优化按钮大小和布局，使界面更加紧凑和美观
  - 改进空间分配比例，使频道列表和关键词部分协调显示
  - 增强布局结构稳定性，防止界面组件被挤压或隐藏
  - 将关键词输入和相关按钮移至独立一行，提高操作直观性和空间利用率
  - 限制已配置频道列表的显示高度为 3 行，优化整体布局平衡
  - 改进各控件间的间距设置，使界面更加紧凑有序
  - 增加关键词输入框的默认宽度，并设置自适应拉伸，窗口放大时自动扩展
  - 优化关键词标签与输入框的比例关系，使关键词输入占据更多水平空间
  - 优化频道列表标题，动态显示当前已配置的频道数量，增强用户信息感知

- **普通下载界面优化**:
  - 调整下载选项标签卡布局，将下载路径设置项移至标签卡底部
  - 减少媒体类型选项上下留白，优化垂直空间使用
  - 调整控件间距和对齐方式，使内容靠上显示，提高信息密度
  - 添加弹性空间，确保界面元素分布合理，即使在较小窗口下也能良好显示
  - 添加适当的空间间隔，使界面元素排布更加合理
  - 优化用户操作流程，提高界面的直观性和一致性
  - 重构频道配置选项卡的布局，使用垂直分割器分隔频道列表和关键词部分
  - 优化按钮大小和布局，使界面更加紧凑和美观
  - 改进空间分配比例，使频道列表和关键词部分协调显示
  - 增强布局结构稳定性，防止界面组件被挤压或隐藏

### 修复

- **修复下载界面问题**:

  - 修复因界面改造遗留的信号连接问题，移除对已不存在控件的引用（如 add_keyword_button 和 remove_keyword_button）
  - 清理关键词标签页相关代码，移除条件判断代码块，确保界面加载稳定性
  - 优化日志输出，统一下载界面初始化完成的日志格式
  - 清理 use_keywords 模式下的冗余代码，简化代码结构
  - 完善界面重构过程，确保所有关联代码一致性
  - 解决导航树中下载功能在主窗口无法正确处理的 bug
  - 完善导航处理逻辑，优化用户体验

- **修复工具栏位置保存问题**:

  - 修复了工具栏拖动到界面右侧后关闭重启程序时位置未被保存的问题
  - 增强工具栏状态变化的监测机制，捕获更多可能的位置变更事件
  - 添加鼠标事件过滤器，确保能捕获工具栏拖动结束事件
  - 优化窗口状态保存逻辑，确保工具栏位置被正确保存到配置文件
  - 改进应用程序关闭流程，在关闭前主动触发一次窗口状态保存
  - 增加调试日志，便于追踪工具栏位置保存和恢复过程
  - 优化配置保存接口，确保内存中的 UI 配置能正确同步到配置文件

- **修复窗口信号处理问题**:
  - 解决启动时出现的工具栏信号断开连接警告
  - 优化工具栏信号监听机制，使用安全的方式处理信号连接和断开
  - 彻底重构信号连接代码，使用新的连接策略完全避免先断开连接的操作
  - 取消尝试断开信号的做法，直接进行信号连接，避免产生不必要的警告信息
  - 添加详细日志记录信号连接过程，便于调试和故障排除
  - 使用简洁安全的信号连接方式，增强代码的可靠性和可维护性
  - 改进工具栏状态变化监听的稳定性和可靠性
  - 消除控制台中的运行时警告信息，提升程序启动体验

## [1.7.4] - 2025-04-02

### 界面改进

- **设置按钮优化**:
  - 从导航树中移除了设置按钮，简化导航结构
  - 在菜单栏文件菜单中添加了设置按钮，提高可访问性
  - 优化工具栏设置按钮的处理方式，直接加载设置界面
  - 修改设置按钮的处理逻辑，使其与其他工具栏按钮一致
  - 确保设置功能的实现符合"功能单一性"原则，增强代码可维护性

## [1.7.3] - 2025-04-02

### 功能增强

- **应用主题管理优化**：改进主题切换逻辑，优化主题预览功能，减少主题反复应用造成的界面闪烁，提升用户体验
- **增强主题兼容性**：针对深色主题模式下的文本显示问题进行优化，确保所有输入控件在不同主题下都具有良好的可读性
- **配置保存机制优化**：改进配置保存流程，避免不必要的主题重复加载，提高界面响应速度

### 性能优化

- **界面响应性能提升**:
  - 修复窗口最大化、最小化响应慢的问题
  - 引入延迟式窗口尺寸处理机制，使用单次触发计时器优化窗口调整事件
  - 优化资源监控函数，避免使用阻塞式 CPU 使用率检测
  - 延长资源监控和网络状态检查的更新间隔，减少 UI 线程负担
  - 改进网络状态检查，减少超时时间，避免长时间网络阻塞影响界面响应

### 界面改进

- **欢迎界面优化**:

  - 移除弹出式欢迎对话框，改为在主界面中央直接显示水印式欢迎信息
  - 设计半透明水印效果，提供视觉引导但不干扰用户操作
  - 调整水印文字透明度至 60%，确保在各种背景下都清晰可见
  - 优化文字大小和位置，确保在不同窗口尺寸下都能正确显示
  - 改善用户首次进入应用的体验，无需点击确认按钮即可开始操作

- **设置界面优化**:

  - 移除取消按钮，简化设置操作流程
  - 实现保存按钮智能状态管理，仅在设置有变更时才可点击
  - 优化设置变更检测机制，任何控件值变化时自动启用保存按钮
  - 设置保存后按钮自动禁用，提供更明确的视觉反馈
  - 保留设置状态，不再自动关闭设置视图，便于连续调整设置
  - 调整底部按钮位置，将保存设置按钮置于左侧，重置为默认按钮置于右侧，符合用户直觉
  - 改善操作流程，使常用功能更易于访问

- **任务概览组件优化**:

  - 增加任务状态标签的字体大小和可视对比度
  - 将"活跃任务"、"已完成"、"等待中"、"失败"等标签字号增大至 10pt 并添加粗体效果
  - 统一任务状态标签与对应数字的颜色，创建更一致的视觉体验
  - 增大数字统计的字体大小至 16pt，提高信息层级和可读性
  - 强化任务状态的视觉标识，帮助用户更快速了解任务情况

- **历史转发界面优化**:

  - 重构下方固定区域，将"转发规则列表"和"转发状态"改为标签页切换方式
  - 优化信息展示区域的空间利用率，避免同时显示两个大型表格造成的视觉压力
  - 实现更灵活的内容切换体验，使用户可以聚焦于当前关注的信息
  - 减少界面垂直滚动需求，改善在较小分辨率屏幕上的可用性
  - 统一界面风格，与其他功能模块保持一致的交互体验

- **主窗口导航改进**:

  - 在工具栏添加"返回主页"按钮，提供快速返回欢迎页面的功能
  - 优化工具栏布局，使功能按钮排序更加符合使用逻辑
  - 改进视图切换机制，保持页面状态连续性

- **实时监听界面改进**:

  - 将监听配置、消息过滤和通知设置从滚动区域改为标签页布局
  - 优化界面结构，提高可用性和空间利用率
  - 增加监听配置区域的高度，提高频道列表的可见性
  - 重构消息监控界面，使用层次化结构，并固定在配置区域下方
  - 实现更清晰的功能模块划分，减少用户的认知负担
  - 改进界面的垂直空间分配，消息监控区域获得更大的显示空间
  - 修复已配置监听频道显示不全的问题，增加列表高度
  - 减小消息监控区域标题与内容之间的间距，优化视觉效果
  - 统一群组框样式，减小边距和内部间距，提高空间利用率
  - 移除多余的 GroupBox 标题，直接使用标签页显示消息内容
  - 进一步降低边距和内部间距，最大化用户界面的可用空间
  - 增加频道列表的显示高度至 240 像素，确保充分显示已配置的频道
  - 移除标签页内部重复的标题，减少垂直空间浪费，使界面更加简洁
  - 将标签页直接作为组织界面的主要结构，避免嵌套标题带来的视觉冗余
  - 优化内部布局结构，直接使用标签页作为容器，减少布局层级

- **本地下载界面优化**:

  - 重构频道配置区域布局，将"从消息 ID"行改为左对齐，提高直观性
  - 移动"添加频道"和"删除所选"按钮至"从消息 ID"同一行，优化操作流程
  - 将下载状态和下载列表区域改为标签页切换式布局，提高信息展示效率
  - 优化下载状态标签页，添加色彩提示和操作引导说明
  - 优化下载列表标签页，添加使用说明和清晰的任务进度显示
  - 实现标签页自动提示功能，通过星号(\*)标记有更新的标签页
  - 合理调整 GroupBox 样式和布局参数，修复标题被内容遮挡的问题
  - 添加标签页切换事件处理，优化用户体验
  - 统一各界面元素间距和对齐方式，创建一致的视觉体验
  - 优化底部按钮尺寸和样式，保持与其他界面一致的操作方式
  - 添加状态色彩反馈，使下载状态和进度更加直观

- **界面布局统一化改进**:
  - 重构普通下载、本地上传和历史转发界面，统一采用与监听界面相同的布局方式
  - 将左右分栏式布局改为上下布局，上部为标签页配置面板，下部为操作与状态显示区域
  - 统一采用 QTabWidget 组织配置选项，提高界面的一致性和可用性
  - 优化垂直空间分配，为实时操作区域提供更多显示空间
  - 降低全局边距和内部间距，增加可用区域的信息密度
  - 采用统一的组框样式，创建连贯一致的视觉体验
  - 简化界面层次结构，减少嵌套深度，提高界面的清晰度
  - 实现更合理的空间划分，增强各功能模块的可见性和操作便捷性
  - 优化配置表单布局，减少视觉冗余，突出关键控件
  - 为常用操作创建统一的底部操作按钮区，增强界面的直观性
  - 将本地上传界面的文件选择器从独立组框移到配置标签页中，提高空间利用率和布局一致性
  - 进一步优化界面层次结构，减轻认知负担，强化界面的整体连贯性
  - 优化本地上传界面，改进目标频道列表尺寸，确保显示足够的频道条目
  - 重新布局上传选项，采用网格布局更高效利用水平空间
  - 解决上传队列标题被覆盖问题，增加标题下方边距
  - 重构按钮位置，将队列管理按钮合并到底部操作区，减少界面冗余
  - 调整上传界面垂直空间分配比例，减小上部标签页区域高度，增加下方上传队列区域比例
  - 优化界面内容显示密度，确保关键操作区域拥有足够的显示空间
  - 改进上传界面下方区域布局，使用扁平化设计替代传统 GroupBox，提升视觉清晰度
  - 采用水平布局显示上传状态信息，优化垂直空间利用率和信息展示效果
  - 修复上传队列标题被遮挡问题，采用标签标题替代组框标题，确保所有 UI 元素正常显示

### 优化

- **系统监控优化**:
  - 降低网络连接错误的日志级别，减少日志文件体积
  - 优化网络连接检测方法，使用非 SSL 连接提升检测速度
  - 改进系统资源统计方法，消除 UI 线程阻塞

### 修复

- **修复样式问题**:

  - 移除不支持的 text-shadow 样式属性，消除控制台警告信息
  - 优化欢迎水印文字样式，调整透明度为 60%，提高可读性
  - 简化样式表结构，提高渲染效率

- **修复主题切换问题**:

  - 解决程序可能自动更改应用主题的问题
  - 避免在配置加载和保存时重复应用主题
  - 增加主题变更前的条件检查，确保只在必要时才应用新主题
  - 优化主题变更日志，提供更详细的状态信息
  - 减少不必要的主题重新应用，提高界面稳定性
  - 修复设置界面中取消操作后主题不恢复的问题
  - 实现设置界面中的主题临时预览功能，只有保存后才永久应用
  - 确保取消设置操作时正确恢复到原始主题
  - 修复主窗口未连接设置保存信号导致的设置后主题应用问题

- **修复界面交互问题**:

  - 修复设置保存后状态栏消息显示错误，添加缺失的状态消息显示功能
  - 优化状态栏消息显示逻辑，提供统一的消息显示接口
  - 改进消息超时机制，确保状态消息显示时长合理
  - 修复工具栏拖动后无法放回原位的问题，增强工具栏位置记忆功能
  - 完善窗口状态保存机制，确保工具栏位置状态被正确保存和恢复
  - 增加工具栏状态变化监听，自动保存工具栏位置变更
  - 添加窗口显示事件处理，确保窗口初始化时正确加载所有 UI 元素状态
  - 优化工具栏区域设置，允许工具栏在顶部、底部或两侧停靠

- **修复日志查看器问题**:
  - 解决日志查看器无法找到日志文件的问题
  - 优化日志文件查找机制，支持自动检测最新的日志文件
  - 添加固定名称的日志文件(tg_manager.log)，便于日志查看器快速定位
  - 增强日志解析能力，支持多种日志格式解析
  - 改进空日志文件和格式不匹配的处理逻辑
  - 优化日志查看器界面，添加文件路径状态显示
  - 提高日志系统的可靠性和用户友好性

### 文档更新

- **添加配置文件说明文档**：在 README.md 中添加详细的配置说明部分，包括 GENERAL、DOWNLOAD、UPLOAD、FORWARD、MONITOR 和 UI 各部分的配置项解释、数据类型和示例值
- **配置示例文件完善**：更新 config_example.json，提供完整的配置示例，帮助用户快速理解和配置应用
- **频道标识格式说明**：新增对支持的频道标识格式(用户名、链接、ID 等)的详细说明
- **媒体类型说明**：新增支持的媒体类型列表及其功能说明

## [1.7.2] - 2025-04-01

### 改进

- **主题系统简化**:
  - 移除了自定义主题属性功能，简化 UI 配置结构
  - 清理了 config.json 中的 custom_theme 残留配置
  - 优化主题切换逻辑，直接应用预定义主题而不使用自定义属性
  - 简化了主题管理器的 apply_theme 方法，移除对自定义颜色的处理
  - 修复了 QHeaderView 和 QListWidget 的样式刷新问题

### 优化

- **配置文件简化**:
  - 删除 UI 设置中不必要的配置项，减小配置文件体积
  - 重构了主题配置的保存和加载逻辑，提高系统性能
  - 统一了主题应用流程，消除不必要的系统开销

### 界面改进

- **下载界面优化**:
  - 合并普通下载和关键词下载功能，简化用户操作流程
  - 在频道配置标签卡中添加关键词筛选功能，提高界面集成度
  - 移除导航树中的关键词下载选项，减少用户界面复杂度
  - 统一下载流程，无论是否使用关键词都采用相同的操作步骤
  - 优化频道列表和关键词列表的空间分配，提高信息展示效率

### 修复

- 修复主题管理器中的刷新部件样式失败问题

  - 移除了复杂的自定义主题属性功能的残留代码
  - 移除了导致 QHeaderView.update() 和 QListWidget.update() 调用失败的递归刷新逻辑
  - 简化了主题应用流程，减少不必要的 UI 刷新操作
  - 确保主题切换稳定可靠，不再产生错误日志

- 修复实时监听界面在窗口缩小时的布局混乱问题
  - 添加 QScrollArea 滚动区域，确保所有控件在界面缩小时仍可访问
  - 优化表单布局结构，使用垂直布局和水平布局的合理嵌套
  - 将单行复选框拆分为多行，避免水平空间不足时的排版问题
  - 调整消息面板的伸展系数，增加其在垂直方向的比例
  - 为关键控件设置合适的尺寸策略(SizePolicy)，确保合理的空间分配
  - 添加弹性空间(stretch)，优化组件对齐方式

## [1.7.1] - 2025-04-01

### 新增

- **帮助文档系统**:

  - 实现了帮助文档视图，提供应用的说明和使用指南
  - 添加了分类目录树导航，便于用户快速查找所需信息
  - 集成了内容浏览器，支持富文本显示和外部链接打开
  - 提供基本的导航功能，如前进、后退和主页按钮

- **任务批量管理**:

  - 添加了暂停所有任务功能，支持一键暂停所有正在运行的任务
  - 添加了恢复所有任务功能，支持一键恢复所有暂停中的任务
  - 添加操作结果反馈，显示成功暂停/恢复的任务数量

- **状态栏信息显示**:
  - 实现了多功能状态栏，提供实时系统和应用状态信息
  - 添加了客户端连接状态显示，实时反映 Telegram 客户端的连接情况
  - 集成了网络状态监测，显示当前网络连接质量
  - 添加了系统资源监控，实时显示 CPU 和内存使用情况
  - 支持状态颜色动态变化，直观反映系统状态变化

### 改进

- **界面组件优化**:

  - 优化导航树和任务概览布局，提高界面可用性
  - 改进分割器比例，提供更合理的空间分配
  - 统一下载视图和上传视图的 UI 布局，提升一致性体验
  - 优化任务概览组件，减小边距和字体，适应更紧凑的显示需求
  - 优化视图窗口尺寸策略，提供更灵活的缩放体验
  - 简化界面布局，降低复杂度

- **系统监控与反馈**:
  - 改进了资源使用统计算法，提供更准确的 CPU 和内存使用数据
  - 优化状态更新机制，减少 UI 刷新带来的性能开销
  - 增强网络连接检测逻辑，更准确地反映网络连接状态
  - 客户端状态显示优化，包含更多连接细节信息
  - 在应用关闭时正确清理定时器资源，避免资源泄漏

### 修复

- 修复主窗口的大小调整事件处理，确保侧边栏比例正确
- 优化任务概览组件的空间利用，减小边距提高可用面积
- 修复下载视图和上传视图的布局问题，改进尺寸策略

## [1.7.0] - 2025-03-30

### 新增

- **图形用户界面实现**:
  - ✅ 实现基于 PySide6 的完整图形用户界面
  - ✅ 构建主窗口框架，支持视图切换和导航
  - ✅ 实现导航树和任务概览组件
  - ✅ 创建下载、上传、转发、监听、任务管理和设置模块的界面
  - ✅ 实现配置加载和保存功能
  - ✅ 添加工具栏功能，包含登录、设置、任务管理器和日志查看器快捷按钮
  - ✅ 优化用户交互体验

### 改进

- **界面架构**:

  - 采用 Model-View 架构分离数据和界面
  - 实现事件驱动的信号-槽机制，提高界面响应性
  - 统一的视图加载和配置管理
  - 集成 Qt 样式系统，提供美观的用户界面

- **界面组件优化**:
  - 重新设计任务概览组件，使用直观的数字统计和现代化布局
  - 优化任务列表显示，添加状态颜色标识和进度动态更新
  - 改进布局结构，从底部停靠区移至左侧，提高信息可视性
  - 增强界面元素的视觉层次感，便于快速获取重要信息

### 修复

- 解决多个视图构造函数参数传递问题
- 修复 QDockWidget 警告提示
- 优化布局结构，使用 QStackedLayout 替代 QVBoxLayout
- 修复配置加载问题，确保各视图能正确初始化

## [1.6.0] - 2024-04-01

### 优化状态

- **业务逻辑与界面完全分离**:

  - ✅ 已实现 `LoggerEventAdapter` 适配器，连接日志系统与事件系统
  - ✅ 已实现 `EventEmitter` 类作为事件系统基础
  - ✅ 所有核心模块（Downloader、Uploader、Forwarder、Monitor、DownloaderSerial）已重构，使用事件系统传递用户界面信息
  - ✅ 已实现 `UICallback` 接口，提供统一的回调结构
  - ✅ 已实现 `EventToUIAdapter`，将事件转发到 UI 回调

- **异步处理机制完善**:

  - ✅ 已实现 `CancelToken` 和 `PauseToken` 类，支持任务取消和暂停恢复
  - ✅ 已实现 `TaskContext` 类，集成多种控制机制
  - ✅ 已实现 `TaskManager` 和 `TaskScheduler`，提供完整的任务管理系统
  - ✅ 所有耗时操作均采用异步接口，支持取消和暂停

- **错误处理机制升级**:

  - ✅ 实现细粒度的错误处理和报告机制
  - ✅ 错误信息包含类型、可恢复性等详细信息
  - ✅ 统一的错误上报机制，确保 UI 可获取全面的错误状态

- **配置模型优化**:

  - ✅ 采用 Pydantic 模型进行配置验证
  - ✅ 配置结构清晰，支持验证和默认值
  - ✅ 配置管理器可以与 UI 无缝交互

- **资源管理系统**:
  - ✅ 文件操作使用 context manager 管理资源
  - ✅ 任务系统确保资源正确释放
  - ✅ 实现统一的资源管理方式

### UI 界面开发对接步骤

1. **初始化 UI 框架**:

   - 选择 PyQt6/PySide6 作为 UI 框架
   - 创建基本应用程序结构
   - 设计主窗口和多标签页界面

2. **实现 UI 状态管理**:

   - 连接已有的`UIState`系统
   - 实现`UICallback`接口
   - 建立 UI 组件与状态的双向绑定

3. **配置界面**:

   - 为每个功能模块创建配置表单
   - 将表单连接到配置模型
   - 实现配置验证和即时反馈
   - 添加配置导入/导出功能

4. **功能模块界面**:

   - 为每个核心功能创建专用界面:
     - 转发界面
     - 下载界面
     - 上传界面
     - 监听界面
   - 连接界面组件与事件系统

5. **系统集成**:

   - 实现全局设置和主题管理
   - 添加日志查看器和状态监控
   - 设计系统托盘集成
   - 实现键盘快捷键

6. **测试与优化**:

   - 进行 UI 响应性能测试
   - 优化组件布局和用户体验
   - 实现异常情况下的 UI 稳定性
   - 支持多显示器和高 DPI 设置

7. **打包与发布**:
   - 为 Windows/Linux 平台创建安装包
   - 设计自动更新机制
   - 优化安装体验

### 技术准备

- 已创建 UI 示例代码，展示业务逻辑与界面分离的正确方式
- 所有后端功能已准备好与 UI 框架集成
- `MockDownloader`和`ConsoleUISimulator`类提供了集成参考

## [1.5.1] - 2024-03-30

### 新功能

- **界面分离优化**: 完成业务逻辑与界面输出的完全分离
  - 创建`LoggerEventAdapter`适配器，统一连接日志系统和事件系统
  - 重构所有核心模块，移除直接日志输出，使用事件系统传递用户界面信息
  - 保留内部调试日志，但不再直接输出到界面
  - 为 GUI 开发做好准备

### 优化

- **代码结构**: 通过事件系统统一模块间的通信机制
- **错误处理**: 改进错误处理逻辑，提供更详细的错误类型和可恢复性信息
- **进度报告**: 统一的进度和状态报告机制，为后续 GUI 开发奠定基础

### 模块改进

- **Downloader**: 移除直接日志输出，改用事件系统传递下载状态和进度
- **Uploader**: 移除直接日志输出，改用事件系统传递上传状态和进度
- **Forwarder**: 移除直接日志输出，改用事件系统传递转发状态和进度
- **Monitor**: 重构监听机制，使用事件系统传递消息接收和处理状态
- **DownloaderSerial**: 完全重写，使用更现代的异步设计和事件驱动架构

## [1.5.0] - 2024-03-25

### 新增

- **业务逻辑与 UI 分离系统**：
  - 实现 UI 状态管理系统，通过 UIState 和 UICallback 优雅地传递 UI 状态和事件
  - 开发事件到 UI 适配器，将业务逻辑的事件转换为 UI 回调
  - 建立统一的状态管理和事件处理机制
- **任务管理与调度系统**：
  - 实现任务管理器，支持任务创建、监控和状态跟踪
  - 开发任务调度器，支持优先级和先进先出调度模式
  - 提供任务暂停、恢复和取消功能
  - 实现任务统计和历史记录功能
- **示例代码**：
  - 添加 UI 状态和任务管理示例
  - 添加任务取消和恢复示例
  - 添加 UI 和任务管理集成示例，模拟完整的用户界面操作

### 优化

- 优化代码组织结构，采用更符合领域驱动设计的模块划分
- 增强系统扩展性，支持未来更多功能的集成

## [1.4.0] - 2024-03-20

### 新增

- **资源管理系统**：
  - 实现 ResourceManager 类，统一管理临时文件和目录
  - 提供引用计数机制，确保资源能够正确释放
  - 实现会话管理，支持资源分组和批量操作
  - 开发自动清理机制，定期清理过期资源
  - 添加异步和同步接口，便于不同场景使用
- **集成视频处理**：
  - 优化 VideoProcessor，集成资源管理系统
  - 视频缩略图自动注册到资源管理器，确保不会泄漏
- **完善测试用例**：
  - 为 ResourceManager 添加全面的单元测试
  - 更新 VideoProcessor 测试，验证与资源管理器的集成

### 改进

- 优化资源清理策略，提高系统效率
- 增强错误处理，提供更详细的错误信息

## [1.3.0] - 2024-03-15

### 新增

- **UI 配置系统**：
  - 实现 UI 配置模型，支持统一的设置管理
  - 添加配置验证功能，确保配置有效性
  - 开发配置管理器，负责读取、保存和应用配置
  - 提供默认配置生成功能，简化初始设置

### 优化

- 改进配置文件结构，更符合用户习惯
- 提供配置迁移工具，支持不同版本间的配置兼容

## [1.2.0] - 2024-03-10

### 新增

- **统一错误处理系统**：
  - 创建异常基类及子类层次结构，实现更精细的异常分类
  - 开发异常处理器，统一处理各种异常情况
  - 增加错误日志记录与查询功能
  - 实现可恢复性标记，指示异常是否可恢复
  - 提供异常转换工具，简化错误处理流程
  - 添加错误处理装饰器，简化异步和同步函数的错误处理

### 优化

- 改进错误提示信息，更加用户友好
- 完善错误处理文档，方便开发者理解和使用

## [1.1.0] - 2024-03-05

### 新增

- **客户端会话管理**：
  - 实现 ClientManager 类，统一管理 Telegram 客户端
  - 支持多账户登录和会话复用
  - 实现智能重连和会话恢复机制
  - 添加客户端池，优化资源利用
- **配置系统**：
  - 实现 ConfigManager 类，处理应用配置
  - 支持多配置文件和配置继承
  - 添加配置验证和自动修复功能

### 优化

- 改进日志系统，分类记录不同级别的日志
- 优化内存使用，减少资源占用

## [1.0.0] - 2024-03-01

### 初始版本

- **核心功能**：
  - 实现基础的 Telegram 消息转发功能
  - 支持媒体文件的下载和上传
  - 提供基本的过滤条件配置
  - 实现简单的状态跟踪和报告
- **工具和辅助功能**：
  - 实现日志记录系统
  - 添加基础的异常处理
  - 提供简单的命令行界面

## [0.7.5] - 2024-03-30

### 改进

- 优化上传模块的转发逻辑，参考转发模块实现了多目标频道的高效上传
- 为上传模块添加频道权限检测功能，自动识别非禁止转发的频道并优先使用
- 实现先上传到一个非禁止转发频道，然后使用复制转发到其他目标频道的功能
- 添加错误处理机制，当第一个目标频道上传失败时自动尝试下一个频道
- 大幅降低多频道上传的耗时和流量消耗，提高了上传效率

## [0.7.4] - 2024-03-29

### 改进

- 优化上传模块的 caption 逻辑，从使用文件夹名称改为读取 title.txt 文件内容
- 支持单文件上传和媒体组上传从同级目录的 title.txt 读取说明文字
- 添加 title.txt 文件不存在或读取失败时的回退机制，保持与之前行为的兼容性
- 上传单文件时自动跳过 title.txt 文件，避免重复上传

## [0.7.3] - 2024-03-28

### 修复

- 修复了由 auth.ExportAuthorization 导致的 FloodWait 错误处理问题
- 增强了数据中心切换和授权过程中的错误处理机制
- 改进了错误消息解析，准确提取等待时间
- 修复了 current_dc_id 获取方式，正确区分属性和方法调用
- 修复了零大小文件的检测和处理
- 完善了 media 下载过程中的错误处理
- 统一了顺序下载和并行下载模式中的错误处理机制
- 统一了媒体组文本文件的命名，所有文本文件现在统一使用"title.txt"作为文件名

## [0.7.2] - 2023-08-15

### 改进

- 统一普通下载和关键词下载的配置结构，使用相同的配置模式
- 优化配置项管理，提高代码重用性和一致性
- 简化用户配置流程，采用统一的配置方式

### 变更

- 移除了公共配置中的`source_channels`、`start_id`和`end_id`字段，统一使用`downloadSetting`配置
- 无论是普通下载还是关键词下载，均使用`downloadSetting`数组中的配置项
- 关键词下载模式下，使用`downloadSetting`中的`keywords`字段进行筛选
- 普通下载模式下，忽略`downloadSetting`中的`keywords`字段

### 修复

- 解决了普通下载和关键词下载使用不同配置结构导致的潜在问题
- 修复了在某些情况下配置解析不一致的问题

## [0.7.1] - 2023-07-10

### 改进

- 优化本地文件组织结构，按媒体组 ID 进行二级目录分类
- 添加媒体组文本自动保存功能，在每个媒体组文件夹中创建文本文件存储媒体组的文字内容
- 增强普通下载模式和关键词下载模式下的文件结构一致性
- 改进媒体组内文件的组织方式，确保相关文件存放在同一目录中
- 增强用户体验，通过合理文件组织使查找相关媒体更加便捷

## [0.7.0] - 2023-07-05

### 新增

- 添加关键词下载功能，支持根据消息文本中的关键词筛选下载内容
- 新增`downloadKeywords`命令，专用于关键词下载模式
- 实现关键词匹配消息文本和说明文字功能，支持大小写不敏感匹配
- 添加关键词目录组织功能，自动按关键词创建子目录
- 升级配置结构，新增`downloadSetting`数组，支持多频道多关键词配置
- 为每个下载设置项添加单独的源频道、ID 范围、媒体类型和关键词配置

### 改进

- 重构下载模块，支持三种下载模式：顺序下载、并行下载和关键词下载
- 优化目录创建逻辑，根据不同下载模式自动选择合适的目录组织方式
- 增强配置文件结构，保持向后兼容性
- 改进关键词匹配算法，提高匹配准确性和效率
- 优化日志输出，更清晰地显示关键词匹配和下载状态
- 增强下载配置的灵活性，简化多源频道配置流程

### 修复

- 修复关键词下载模式下媒体组处理的逻辑问题，确保当媒体组中任意消息包含关键词时，下载该媒体组中的所有文件
- 优化媒体组关键词匹配算法，提高媒体组下载的完整性和准确性
- 修复 `_iter_messages` 函数在获取消息时可能导致的无限循环问题
- 添加最大尝试次数限制，防止在消息不可获取时陷入死循环
- 改进消息获取算法，使用更高效的方式处理可能不存在的消息 ID
- 实现智能批次调整，当无法获取消息时自动减小批次大小
- 优化日志输出，提供更清晰的消息获取状态和错误信息
- 增强对缺失消息的处理，跳过不存在的消息 ID 而不影响其他消息获取
- 修复媒体组 ID 类型处理问题，避免在处理整数类型的媒体组 ID 时导致的类型错误

## [0.6.1] - 2023-06-25

### 修复

- 修复了 `
